<UserControl x:Class="FMUI.Wpf.Views.CardSurfaceView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:FMUI.Wpf.ViewModels"
             xmlns:editors="clr-namespace:FMUI.Wpf.ViewModels.Editors"
             xmlns:controls="clr-namespace:FMUI.Wpf.Controls"
             xmlns:behaviors="clr-namespace:FMUI.Wpf.Infrastructure.Behaviors"
             xmlns:views="clr-namespace:FMUI.Wpf.Views"
             mc:Ignorable="d"
             d:DataContext="{d:DesignInstance Type=vm:CardSurfaceViewModel}"
             Focusable="True">
    <UserControl.InputBindings>
        <KeyBinding Key="Z"
                    Modifiers="Control"
                    Command="{Binding UndoCommand}" />
        <KeyBinding Key="Y"
                    Modifiers="Control"
                    Command="{Binding RedoCommand}" />
        <KeyBinding Key="Z"
                    Modifiers="Control,Shift"
                    Command="{Binding RedoCommand}" />
        <KeyBinding Key="Left"
                    Command="{Binding NudgeLeftCommand}" />
        <KeyBinding Key="Right"
                    Command="{Binding NudgeRightCommand}" />
        <KeyBinding Key="Up"
                    Command="{Binding NudgeUpCommand}" />
        <KeyBinding Key="Down"
                    Command="{Binding NudgeDownCommand}" />
        <KeyBinding Key="Escape"
                    Command="{Binding ClearSelectionCommand}" />
        <KeyBinding Key="Delete"
                    Command="{Binding RemoveSelectedCardsCommand}" />
    </UserControl.InputBindings>
    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
        <views:RelativePositionConverter x:Key="RelativePositionConverter" />
        <views:NullToVisibilityConverter x:Key="NullToVisibilityConverter" />

        <Style x:Key="CardBorderStyle" TargetType="Border">
            <Setter Property="Padding" Value="20" />
            <Setter Property="CornerRadius" Value="18" />
            <Setter Property="Background">
                <Setter.Value>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                        <GradientStop Color="#1C2431" Offset="0" />
                        <GradientStop Color="#141A24" Offset="1" />
                    </LinearGradientBrush>
                </Setter.Value>
            </Setter>
            <Setter Property="BorderBrush" Value="#222D3C" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="SnapsToDevicePixels" Value="True" />
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect BlurRadius="18" ShadowDepth="0" Opacity="0.22" Color="#000000" />
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <DataTrigger Binding="{Binding IsSelected}" Value="True">
                    <Setter Property="BorderBrush" Value="{StaticResource AccentPrimaryBrush}" />
                    <Setter Property="BorderThickness" Value="2" />
                    <Setter Property="Effect">
                        <Setter.Value>
                            <DropShadowEffect BlurRadius="24" ShadowDepth="0" Opacity="0.35" Color="#2EC4B6" />
                        </Setter.Value>
                    </Setter>
                    <Setter Property="Background">
                        <Setter.Value>
                            <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                                <GradientStop Color="#1F2E3F" Offset="0" />
                                <GradientStop Color="#17202D" Offset="1" />
                            </LinearGradientBrush>
                        </Setter.Value>
                    </Setter>
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="CardTitleTextStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="18" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Foreground" Value="{StaticResource PrimaryTextBrush}" />
        </Style>

        <Style x:Key="CardSubtitleTextStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="13" />
            <Setter Property="Foreground" Value="{StaticResource NeutralTextBrush}" />
        </Style>

        <Style x:Key="CardMetricValueTextStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="42" />
            <Setter Property="FontWeight" Value="Bold" />
            <Setter Property="Foreground" Value="{StaticResource PrimaryTextBrush}" />
            <Setter Property="TextOptions.TextFormattingMode" Value="Display" />
        </Style>

        <Style x:Key="CardMetricLabelTextStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="14" />
            <Setter Property="Foreground" Value="{StaticResource NeutralTextBrush}" />
        </Style>

        <Style x:Key="CardListPrimaryTextStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="14" />
            <Setter Property="Foreground" Value="{StaticResource PrimaryTextBrush}" />
        </Style>

        <Style x:Key="CardListSecondaryTextStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="13" />
            <Setter Property="Foreground" Value="{StaticResource NeutralTextBrush}" />
        </Style>

        <Style x:Key="PaletteListBoxItemStyle" TargetType="ListBoxItem">
            <Setter Property="Padding" Value="12" />
            <Setter Property="Margin" Value="0,0,0,10" />
            <Setter Property="HorizontalContentAlignment" Value="Stretch" />
            <Setter Property="Background" Value="{StaticResource OverlayListItemBrush}" />
            <Setter Property="BorderBrush" Value="{StaticResource OverlayListItemBorderBrush}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="Focusable" Value="True" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListBoxItem">
                        <Border x:Name="Container"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="14"
                                SnapsToDevicePixels="True">
                            <ContentPresenter HorizontalAlignment="Stretch"
                                              VerticalAlignment="Center"
                                              Margin="0" />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Container" Property="Background" Value="{StaticResource OverlayListItemHoverBrush}" />
                                <Setter TargetName="Container" Property="BorderBrush" Value="{StaticResource AccentPrimaryBrush}" />
                            </Trigger>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="Container" Property="Background" Value="{StaticResource OverlayListItemSelectedBrush}" />
                                <Setter TargetName="Container" Property="BorderBrush" Value="{StaticResource AccentPrimaryBrush}" />
                                <Setter TargetName="Container" Property="BorderThickness" Value="2" />
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="Container" Property="Opacity" Value="0.45" />
                            </Trigger>
                            <MultiTrigger>
                                <MultiTrigger.Conditions>
                                    <Condition Property="IsFocused" Value="True" />
                                    <Condition Property="IsSelected" Value="False" />
                                </MultiTrigger.Conditions>
                                <Setter TargetName="Container" Property="BorderBrush" Value="{StaticResource AccentPrimaryBrush}" />
                                <Setter TargetName="Container" Property="BorderThickness" Value="2" />
                                <Setter TargetName="Container" Property="Background" Value="{StaticResource OverlayListItemHoverBrush}" />
                            </MultiTrigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="controls:CardDragThumb">
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="controls:CardDragThumb">
                        <Border Background="{TemplateBinding Background}"
                                CornerRadius="18" />
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="controls:CardResizeThumb">
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="controls:CardResizeThumb">
                        <Border Background="{TemplateBinding Background}"
                                CornerRadius="3"
                                BorderBrush="Transparent"
                                BorderThickness="1" />
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <DataTemplate x:Key="CardPreviewTemplate" DataType="{x:Type vm:CardPreviewViewModel}">
            <Border Width="{Binding Width}"
                    Height="{Binding Height}"
                    Canvas.Left="{Binding Left}"
                    Canvas.Top="{Binding Top}"
                    CornerRadius="18"
                    BorderThickness="2"
                    IsHitTestVisible="False">
                <Border.Style>
                    <Style TargetType="Border">
                        <Setter Property="Background" Value="#402EC4B6" />
                        <Setter Property="BorderBrush" Value="{StaticResource AccentPrimaryBrush}" />
                        <Setter Property="Opacity" Value="0.9" />
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding IsValid}" Value="False">
                                <Setter Property="Background" Value="#40ED5E68" />
                                <Setter Property="BorderBrush" Value="#FFED5E68" />
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Border.Style>
            </Border>
        </DataTemplate>

        <Style x:Key="CardHeaderButtonStyle" TargetType="Button" BasedOn="{StaticResource SurfaceToolbarButtonStyle}">
            <Setter Property="Padding" Value="10,4" />
            <Setter Property="Margin" Value="12,0,0,0" />
            <Setter Property="FontSize" Value="12" />
        </Style>

        <DataTemplate x:Key="StandardListItemTemplate" DataType="{x:Type vm:CardListItemViewModel}">
            <Border Margin="0,0,0,10"
                    Padding="0,0,0,8"
                    Background="Transparent"
                    BorderBrush="#1F2A39"
                    BorderThickness="0 0 0 1"
                    ToolTipService.InitialShowDelay="250"
                    ToolTipService.ShowDuration="8000">
                <Border.Style>
                    <Style TargetType="Border">
                        <Setter Property="Background" Value="Transparent" />
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#162434" />
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Border.Style>
                <Border.ToolTip>
                    <ToolTip Style="{StaticResource CardToolTipStyle}">
                        <StackPanel>
                            <TextBlock Text="{Binding Primary}" FontWeight="SemiBold" />
                            <TextBlock Text="{Binding Secondary}" Margin="0,6,0,0" Foreground="{StaticResource NeutralTextBrush}">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Visibility" Value="Collapsed" />
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding HasSecondary}" Value="True">
                                                <Setter Property="Visibility" Value="Visible" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                            <TextBlock Text="{Binding Tertiary}" Margin="0,4,0,0" Foreground="{StaticResource NeutralTextBrush}">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Visibility" Value="Collapsed" />
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding HasTertiary}" Value="True">
                                                <Setter Property="Visibility" Value="Visible" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                        </StackPanel>
                    </ToolTip>
                </Border.ToolTip>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="2*" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <TextBlock Text="{Binding Primary}"
                               Style="{StaticResource CardListPrimaryTextStyle}" />

                    <TextBlock Grid.Column="1"
                               Text="{Binding Secondary}"
                               Style="{StaticResource CardListSecondaryTextStyle}"
                               TextAlignment="Right">
                        <TextBlock.Style>
                            <Style TargetType="TextBlock" BasedOn="{StaticResource CardListSecondaryTextStyle}">
                                <Setter Property="Visibility" Value="Collapsed" />
                                <Setter Property="TextAlignment" Value="Right" />
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding HasSecondary}" Value="True">
                                        <Setter Property="Visibility" Value="Visible" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </TextBlock.Style>
                    </TextBlock>

                    <StackPanel Grid.Column="2" Orientation="Horizontal">
                        <Border Background="#2EC4B622"
                                Padding="8,2"
                                CornerRadius="10"
                                Margin="0,0,8,0">
                            <Border.Style>
                                <Style TargetType="Border">
                                    <Setter Property="Visibility" Value="Collapsed" />
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding HasAccent}" Value="True">
                                            <Setter Property="Visibility" Value="Visible" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Border.Style>
                            <TextBlock Text="{Binding Accent}"
                                       Foreground="{StaticResource AccentPrimaryBrush}"
                                       FontSize="11"
                                       FontWeight="SemiBold" />
                        </Border>
                        <TextBlock Text="{Binding Tertiary}"
                                   Style="{StaticResource CardListSecondaryTextStyle}">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock" BasedOn="{StaticResource CardListSecondaryTextStyle}">
                                    <Setter Property="Visibility" Value="Collapsed" />
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding HasTertiary}" Value="True">
                                            <Setter Property="Visibility" Value="Visible" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>
                    </StackPanel>
                </Grid>
            </Border>
        </DataTemplate>

        <DataTemplate x:Key="FinanceForecastImpactTemplate" DataType="{x:Type vm:FinanceForecastImpactItemViewModel}">
            <Grid Margin="0,0,0,10">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <TextBlock Text="{Binding Label}"
                           Style="{StaticResource CardListPrimaryTextStyle}" />
                <TextBlock Grid.Column="1"
                           Text="{Binding DisplayValue}"
                           Style="{StaticResource CardListPrimaryTextStyle}"
                           FontWeight="SemiBold"
                           Margin="12,0,0,0" />
            </Grid>
        </DataTemplate>

        <DataTemplate x:Key="StatusListItemTemplate" DataType="{x:Type vm:CardListItemViewModel}">
            <Border Margin="0,0,0,10"
                    Padding="0,2,0,6"
                    Background="Transparent"
                    ToolTipService.InitialShowDelay="250"
                    ToolTipService.ShowDuration="8000">
                <Border.Style>
                    <Style TargetType="Border">
                        <Setter Property="Background" Value="Transparent" />
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#162434" />
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Border.Style>
                <Border.ToolTip>
                    <ToolTip Style="{StaticResource CardToolTipStyle}">
                        <StackPanel>
                            <TextBlock Text="{Binding Primary}" FontWeight="SemiBold" />
                            <TextBlock Text="{Binding Secondary}" Margin="0,6,0,0" Foreground="{StaticResource NeutralTextBrush}">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Visibility" Value="Collapsed" />
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding HasSecondary}" Value="True">
                                                <Setter Property="Visibility" Value="Visible" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                        </StackPanel>
                    </ToolTip>
                </Border.ToolTip>
                <DockPanel>
                    <Ellipse Width="10"
                             Height="10"
                             Fill="#2EC4B6"
                             Opacity="0.65"
                             Margin="0,4,12,0"
                             DockPanel.Dock="Left" />
                    <StackPanel>
                        <TextBlock Text="{Binding Primary}"
                                   Style="{StaticResource CardListPrimaryTextStyle}" />
                        <TextBlock Text="{Binding Secondary}"
                                   Style="{StaticResource CardListSecondaryTextStyle}"
                                   Visibility="{Binding HasSecondary, Converter={StaticResource BooleanToVisibilityConverter}}" />
                    </StackPanel>
                </DockPanel>
            </Border>
        </DataTemplate>

        <DataTemplate x:Key="FixtureListItemTemplate" DataType="{x:Type vm:CardListItemViewModel}">
            <Grid Margin="0,0,0,12">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>
                <TextBlock Text="{Binding Primary}"
                           Style="{StaticResource CardListSecondaryTextStyle}" />
                <StackPanel Grid.Column="1" Margin="16,0,0,0">
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                        <TextBlock Text="{Binding Secondary}"
                                   Style="{StaticResource CardListPrimaryTextStyle}" />
                        <Border Background="#2EC4B622"
                                Padding="8,2"
                                CornerRadius="10"
                                Margin="12,0,0,0"
                                Visibility="{Binding HasAccent, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <TextBlock Text="{Binding Accent}"
                                       Foreground="{StaticResource AccentPrimaryBrush}"
                                       FontSize="11"
                                       FontWeight="SemiBold" />
                        </Border>
                    </StackPanel>
                    <TextBlock Text="{Binding Tertiary}"
                               Style="{StaticResource CardListSecondaryTextStyle}"
                               Visibility="{Binding HasTertiary, Converter={StaticResource BooleanToVisibilityConverter}}" />
                </StackPanel>
            </Grid>
        </DataTemplate>

        <DataTemplate x:Key="FormationPlayerTemplate" DataType="{x:Type vm:FormationPlayerViewModel}">
            <controls:FormationPlayerThumb Width="56"
                                            Height="56"
                                            PitchWidth="{Binding RelativeSource={RelativeSource AncestorType=Canvas}, Path=ActualWidth}"
                                            PitchHeight="{Binding RelativeSource={RelativeSource AncestorType=Canvas}, Path=ActualHeight}"
                                            TokenSize="56"
                                            BeginDragCommand="{Binding BeginDragCommand}"
                                            DragDeltaCommand="{Binding DragDeltaCommand}"
                                            DragCompletedCommand="{Binding CompleteDragCommand}"
                                            Cursor="Hand">
                <controls:FormationPlayerThumb.Template>
                    <ControlTemplate TargetType="controls:FormationPlayerThumb">
                        <Border Background="#2EC4B6"
                                CornerRadius="28"
                                BorderBrush="#FFFFFFFF"
                                BorderThickness="2"
                                Padding="8">
                            <Border.Effect>
                                <DropShadowEffect BlurRadius="18"
                                                  ShadowDepth="0"
                                                  Opacity="0.45"
                                                  Color="#AA000000" />
                            </Border.Effect>
                            <TextBlock Text="{Binding Name}"
                                       Foreground="White"
                                       FontSize="12"
                                       FontWeight="SemiBold"
                                       TextWrapping="Wrap"
                                       TextAlignment="Center" />
                        </Border>
                    </ControlTemplate>
                </controls:FormationPlayerThumb.Template>
            </controls:FormationPlayerThumb>
        </DataTemplate>

        <DataTemplate x:Key="FormationLineTemplate" DataType="{x:Type vm:FormationLineViewModel}">
            <StackPanel Margin="0,0,0,18">
                <TextBlock Text="{Binding Role}"
                           Foreground="#B3C6DC"
                           FontSize="12"
                           FontWeight="SemiBold"
                           Margin="0,0,0,6" />
                <ItemsControl ItemsSource="{Binding Players}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <UniformGrid Rows="1" HorizontalAlignment="Stretch" />
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border Margin="6,0"
                                    Padding="14,10"
                                    Background="#1AFFFFFF"
                                    BorderBrush="#33FFFFFF"
                                    BorderThickness="1.2"
                                    CornerRadius="18">
                                <TextBlock Text="{Binding Name}"
                                           Foreground="White"
                                           VerticalAlignment="Center"
                                           HorizontalAlignment="Center"
                                           FontWeight="SemiBold"
                                           FontSize="12"
                                           TextAlignment="Center"
                                           TextWrapping="Wrap" />
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </StackPanel>
        </DataTemplate>

        <DataTemplate x:Key="ComparisonPlayerTemplate">
            <Border Background="{StaticResource SurfaceMediumBrush}"
                    BorderBrush="{StaticResource SurfaceToolbarBorderBrush}"
                    BorderThickness="1"
                    CornerRadius="12"
                    Padding="10,4"
                    Margin="0,0,8,8">
                <TextBlock Text="{Binding}"
                           Foreground="{StaticResource PrimaryTextBrush}"
                           FontWeight="SemiBold" />
            </Border>
        </DataTemplate>

        <DataTemplate x:Key="SquadComparisonMetricTemplate" DataType="{x:Type vm:SquadComparisonMetricViewModel}">
            <Border Background="{StaticResource SurfaceMediumBrush}"
                    BorderBrush="{StaticResource SurfaceToolbarBorderBrush}"
                    BorderThickness="1"
                    CornerRadius="10"
                    Padding="12"
                    Margin="0,0,12,12">
                <StackPanel>
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                        <TextBlock Text="{Binding Metric}"
                                   FontWeight="SemiBold"
                                   Foreground="{StaticResource PrimaryTextBrush}" />
                        <Border Background="{StaticResource AccentPrimaryBrush}"
                                CornerRadius="10"
                                Padding="8,2"
                                Margin="12,0,0,0"
                                Visibility="{Binding TieBadge, Converter={StaticResource NullToVisibilityConverter}}">
                            <TextBlock Text="{Binding TieBadge}"
                                       FontSize="11"
                                       FontWeight="SemiBold"
                                       Foreground="White" />
                        </Border>
                    </StackPanel>
                    <TextBlock Text="{Binding LeaderName}"
                               Margin="0,6,0,0"
                               Foreground="{StaticResource NeutralTextBrush}" />
                    <TextBlock Text="{Binding LeaderValue}"
                               Margin="0,4,0,0"
                               FontSize="16"
                               FontWeight="SemiBold"
                               Foreground="{StaticResource PrimaryTextBrush}" />
                </StackPanel>
            </Border>
        </DataTemplate>

        <DataTemplate x:Key="MetricCardBodyTemplate">
            <StackPanel ToolTipService.IsEnabled="{Binding HasDescription}"
                        ToolTipService.InitialShowDelay="250"
                        ToolTipService.ShowDuration="8000">
                <StackPanel.ToolTip>
                    <ToolTip Style="{StaticResource CardToolTipStyle}">
                        <TextBlock Text="{Binding Description}"
                                   TextWrapping="Wrap"
                                   MaxWidth="280" />
                    </ToolTip>
                </StackPanel.ToolTip>
                <TextBlock Text="{Binding MetricValue}"
                           Style="{StaticResource CardMetricValueTextStyle}" />
                <TextBlock Text="{Binding MetricLabel}"
                           Margin="0,8,0,0"
                           Style="{StaticResource CardMetricLabelTextStyle}" />
            </StackPanel>
        </DataTemplate>

        <DataTemplate x:Key="ListCardBodyTemplate">
            <ItemsControl ItemsSource="{Binding ListItems}"
                          ItemTemplate="{StaticResource StandardListItemTemplate}" />
        </DataTemplate>

        <DataTemplate x:Key="SquadTableCardBodyTemplate">
            <Grid DataContext="{Binding SquadTable}">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <Grid Grid.Row="0" Margin="0,0,0,12">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <WrapPanel Grid.Column="0"
                               VerticalAlignment="Center"
                               Margin="0,0,16,0">
                        <StackPanel Width="160" Margin="0,0,12,0">
                            <TextBlock Text="Position"
                                       Style="{StaticResource CardListSecondaryTextStyle}" />
                            <ComboBox ItemsSource="{Binding PositionFilters}"
                                      SelectedItem="{Binding SelectedPositionFilter, Mode=TwoWay}"
                                      Background="{StaticResource SurfaceMediumBrush}"
                                      Foreground="{StaticResource PrimaryTextBrush}"
                                      BorderBrush="{StaticResource SurfaceToolbarBorderBrush}"
                                      Margin="0,4,0,0"
                                      Padding="6,4"
                                      AutomationProperties.Name="Filter squad by position" />
                        </StackPanel>
                        <StackPanel Width="160" Margin="0,0,12,0">
                            <TextBlock Text="Role"
                                       Style="{StaticResource CardListSecondaryTextStyle}" />
                            <ComboBox ItemsSource="{Binding RoleFilters}"
                                      SelectedItem="{Binding SelectedRoleFilter, Mode=TwoWay}"
                                      Background="{StaticResource SurfaceMediumBrush}"
                                      Foreground="{StaticResource PrimaryTextBrush}"
                                      BorderBrush="{StaticResource SurfaceToolbarBorderBrush}"
                                      Margin="0,4,0,0"
                                      Padding="6,4"
                                      AutomationProperties.Name="Filter squad by role" />
                        </StackPanel>
                        <StackPanel Width="200" Margin="0,0,12,0">
                            <TextBlock Text="Search"
                                       Style="{StaticResource CardListSecondaryTextStyle}" />
                            <TextBox Text="{Binding SearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                     Background="{StaticResource SurfaceMediumBrush}"
                                     Foreground="{StaticResource PrimaryTextBrush}"
                                     BorderBrush="{StaticResource SurfaceToolbarBorderBrush}"
                                     Margin="0,4,0,0"
                                     Padding="6,4"
                                     AutomationProperties.Name="Search squad roster" />
                        </StackPanel>
                    </WrapPanel>

                    <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                        <TextBlock Text="{Binding SelectedCount, StringFormat=Selected: {0}}"
                                   Style="{StaticResource CardListSecondaryTextStyle}"
                                   Margin="0,0,16,0" />
                        <Button Content="Clear Filters"
                                Command="{Binding ClearFiltersCommand}"
                                Style="{StaticResource CardHeaderButtonStyle}"
                                Margin="0,0,8,0"
                                Padding="16,6"
                                AutomationProperties.Name="Clear squad filters" />
                        <Button Content="Clear Selection"
                                Command="{Binding ClearSelectionCommand}"
                                Style="{StaticResource CardHeaderButtonStyle}"
                                Margin="0,0,8,0"
                                Padding="16,6"
                                AutomationProperties.Name="Clear squad selection" />
                        <Button Content="Compare Selected"
                                Command="{Binding CompareCommand}"
                                Style="{StaticResource CardHeaderButtonStyle}"
                                Padding="18,6"
                                AutomationProperties.Name="Compare selected players" />
                    </StackPanel>
                </Grid>

                <DataGrid Grid.Row="1"
                          ItemsSource="{Binding PlayersView}"
                          AutoGenerateColumns="False"
                          CanUserAddRows="False"
                          CanUserDeleteRows="False"
                          CanUserResizeRows="False"
                          HeadersVisibility="Column"
                          GridLinesVisibility="None"
                          BorderThickness="0"
                          RowHeight="42"
                          ColumnHeaderHeight="34"
                          IsReadOnly="True"
                          AlternationCount="2"
                          AlternatingRowBackground="#152030"
                          Background="{StaticResource SurfaceDarkBrush}"
                          Foreground="{StaticResource PrimaryTextBrush}"
                          ScrollViewer.CanContentScroll="True">
                    <DataGrid.Resources>
                        <Style TargetType="DataGridColumnHeader">
                            <Setter Property="Background" Value="{StaticResource SurfaceMediumBrush}" />
                            <Setter Property="Foreground" Value="{StaticResource NeutralTextBrush}" />
                            <Setter Property="BorderBrush" Value="{StaticResource SurfaceToolbarBorderBrush}" />
                            <Setter Property="BorderThickness" Value="0,0,0,1" />
                            <Setter Property="FontSize" Value="12" />
                            <Setter Property="FontWeight" Value="SemiBold" />
                        </Style>
                        <Style TargetType="DataGridRow">
                            <Setter Property="Background" Value="{StaticResource SurfaceDarkBrush}" />
                            <Setter Property="BorderThickness" Value="0,0,0,1" />
                            <Setter Property="BorderBrush" Value="#1A2A3A" />
                            <Setter Property="SnapsToDevicePixels" Value="True" />
                            <Setter Property="Foreground" Value="{StaticResource PrimaryTextBrush}" />
                        </Style>
                        <Style TargetType="DataGridCell">
                            <Setter Property="Background" Value="{StaticResource SurfaceDarkBrush}" />
                            <Setter Property="BorderThickness" Value="0" />
                            <Setter Property="Padding" Value="8,4" />
                        </Style>
                    </DataGrid.Resources>

                    <DataGrid.Columns>
                        <DataGridTemplateColumn Width="40" IsReadOnly="False" SortMemberPath="IsSelected">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <CheckBox IsChecked="{Binding IsSelected, Mode=TwoWay}" HorizontalAlignment="Center" />
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                        <DataGridTextColumn Header="Name"
                                            Binding="{Binding Name}"
                                            Width="2*" />
                        <DataGridTextColumn Header="Position"
                                            Binding="{Binding Position}"
                                            Width="1.1*"
                                            SortMemberPath="Position" />
                        <DataGridTextColumn Header="Role"
                                            Binding="{Binding Role}"
                                            Width="1.2*"
                                            SortMemberPath="Role" />
                        <DataGridTextColumn Header="Morale"
                                            Binding="{Binding Morale}"
                                            Width="1.2*"
                                            SortMemberPath="Morale" />
                        <DataGridTemplateColumn Header="Condition"
                                               SortMemberPath="Condition"
                                               Width="1.2*">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <StackPanel>
                                        <ProgressBar Value="{Binding ConditionPercentage}"
                                                     Maximum="100"
                                                     Height="6"
                                                     Foreground="{StaticResource AccentPrimaryBrush}"
                                                     Background="#152030" />
                                        <TextBlock Text="{Binding ConditionDisplay}"
                                                   Foreground="{StaticResource NeutralTextBrush}"
                                                   FontSize="11"
                                                   Margin="0,4,0,0" />
                                    </StackPanel>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                        <DataGridTemplateColumn Header="Sharpness"
                                               SortMemberPath="MatchSharpness"
                                               Width="1.2*">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <StackPanel>
                                        <ProgressBar Value="{Binding MatchSharpnessPercentage}"
                                                     Maximum="100"
                                                     Height="6"
                                                     Foreground="{StaticResource AccentSecondaryBrush}"
                                                     Background="#152030" />
                                        <TextBlock Text="{Binding MatchSharpnessDisplay}"
                                                   Foreground="{StaticResource NeutralTextBrush}"
                                                   FontSize="11"
                                                   Margin="0,4,0,0" />
                                    </StackPanel>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                        <DataGridTextColumn Header="Avg Rating"
                                            Binding="{Binding AverageRating, StringFormat=F2}"
                                            SortMemberPath="AverageRating"
                                            Width="1.1*" />
                        <DataGridTextColumn Header="Apps"
                                            Binding="{Binding Appearances}"
                                            SortMemberPath="Appearances"
                                            Width="0.9*" />
                        <DataGridTextColumn Header="Minutes"
                                            Binding="{Binding Minutes}"
                                            SortMemberPath="Minutes"
                                            Width="1.1*" />
                        <DataGridTextColumn Header="Nation"
                                            Binding="{Binding Nationality}"
                                            Width="1*"
                                            SortMemberPath="Nationality" />
                        <DataGridTemplateColumn Header="Status"
                                               Width="1.2*">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Border Background="{StaticResource AccentPrimaryBrush}"
                                            CornerRadius="12"
                                            Padding="10,4"
                                            HorizontalAlignment="Left"
                                            Visibility="{Binding HasStatus, Converter={StaticResource BooleanToVisibilityConverter}}">
                                        <TextBlock Text="{Binding Status}"
                                                   FontSize="11"
                                                   FontWeight="SemiBold"
                                                   Foreground="White" />
                                    </Border>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>
                </DataGrid>

                <Border Grid.Row="2"
                        Background="{StaticResource SurfaceMediumBrush}"
                        BorderBrush="{StaticResource SurfaceToolbarBorderBrush}"
                        BorderThickness="1"
                        CornerRadius="12"
                        Padding="16"
                        Margin="0,12,0,0"
                        Visibility="{Binding HasComparison, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                            <TextBlock Text="{Binding ComparisonSummary}"
                                       Style="{StaticResource CardListPrimaryTextStyle}"
                                       FontSize="16"
                                       FontWeight="SemiBold" />
                            <Button Content="Dismiss"
                                    Command="{Binding DismissComparisonCommand}"
                                    Style="{StaticResource CardHeaderButtonStyle}"
                                    Margin="12,0,0,0"
                                    Padding="14,4"
                                    AutomationProperties.Name="Dismiss comparison" />
                        </StackPanel>

                        <ItemsControl ItemsSource="{Binding ComparisonPlayers}"
                                      ItemTemplate="{StaticResource ComparisonPlayerTemplate}"
                                      Margin="0,12,0,0">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel />
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                        </ItemsControl>

                        <ItemsControl ItemsSource="{Binding ComparisonMetrics}"
                                      ItemTemplate="{StaticResource SquadComparisonMetricTemplate}"
                                      Margin="0,8,0,0">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel />
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                        </ItemsControl>
                    </StackPanel>
                </Border>
            </Grid>
        </DataTemplate>

        <DataTemplate x:Key="StatusCardBodyTemplate">
            <ItemsControl ItemsSource="{Binding ListItems}"
                          ItemTemplate="{StaticResource StatusListItemTemplate}" />
        </DataTemplate>

        <DataTemplate x:Key="LineChartCardBodyTemplate">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <StackPanel Orientation="Horizontal" Grid.Row="0" Margin="0,0,0,12">
                    <TextBlock Text="{Binding MetricValue}" Style="{StaticResource CardMetricValueTextStyle}" />
                    <TextBlock Text="{Binding MetricLabel}" Style="{StaticResource CardMetricLabelTextStyle}" Margin="12,16,0,0" />
                </StackPanel>

                <controls:LineChartControl Grid.Row="1"
                                           Series="{Binding ChartSeries}"
                                           MinHeight="180"
                                           Margin="0,0,0,8" />
            </Grid>
        </DataTemplate>

        <DataTemplate x:Key="GaugeCardBodyTemplate">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="2*" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <controls:RadialGaugeControl Gauge="{Binding Gauge}"
                                             Margin="0,0,18,0"
                                             MinHeight="220" />

                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                    <TextBlock Text="{Binding Gauge.DisplaySummary}"
                               Foreground="{StaticResource NeutralTextBrush}"
                               FontSize="13"
                               TextWrapping="Wrap"
                               Margin="0,0,0,12">
                        <TextBlock.Style>
                            <Style TargetType="TextBlock">
                                <Setter Property="Visibility" Value="Visible" />
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding Gauge.DisplaySummary}" Value="{x:Null}">
                                        <Setter Property="Visibility" Value="Collapsed" />
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding Gauge.DisplaySummary}" Value="">
                                        <Setter Property="Visibility" Value="Collapsed" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </TextBlock.Style>
                    </TextBlock>
                    <ItemsControl ItemsSource="{Binding ListItems}"
                                  ItemTemplate="{StaticResource StandardListItemTemplate}" />
                </StackPanel>
            </Grid>
        </DataTemplate>

        <DataTemplate x:Key="TrainingCalendarCardBodyTemplate">
            <views:TrainingCalendarView DataContext="{Binding TrainingCalendar}" />
        </DataTemplate>

        <DataTemplate x:Key="FixtureCalendarCardBodyTemplate">
            <views:FixtureCalendarView DataContext="{Binding FixtureCalendar}" />
        </DataTemplate>

        <DataTemplate x:Key="ForecastCardBodyTemplate">
            <StackPanel>
                <StackPanel.Style>
                    <Style TargetType="StackPanel">
                        <Setter Property="Visibility" Value="Collapsed" />
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding HasForecast}" Value="True">
                                <Setter Property="Visibility" Value="Visible" />
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </StackPanel.Style>

                <StackPanel Orientation="Horizontal"
                            Margin="0,0,0,16">
                    <TextBlock Text="{Binding Forecast.SummaryLabel}"
                               Style="{StaticResource CardListSecondaryTextStyle}"
                               Margin="0,0,12,0" />
                    <TextBlock Text="{Binding Forecast.SummaryValue}"
                               Style="{StaticResource CardListPrimaryTextStyle}"
                               FontSize="16"
                               FontWeight="SemiBold" />
                </StackPanel>

                <TextBlock Text="{Binding Forecast.SliderLabel}"
                           Style="{StaticResource CardListSecondaryTextStyle}" />

                <Slider Minimum="{Binding Forecast.Minimum}"
                        Maximum="{Binding Forecast.Maximum}"
                        Value="{Binding Forecast.Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                        TickFrequency="{Binding Forecast.TickFrequency}"
                        IsSnapToTickEnabled="{Binding Forecast.UseTicks}"
                        Margin="0,12,0,0"
                        AutomationProperties.Name="Finance forecast allocation" />

                <TextBlock Text="{Binding Forecast.ValueDisplay}"
                           Style="{StaticResource CardListPrimaryTextStyle}"
                           FontSize="16"
                           FontWeight="SemiBold"
                           Margin="0,8,0,16" />

                <ItemsControl ItemsSource="{Binding Forecast.Impacts}"
                              ItemTemplate="{StaticResource FinanceForecastImpactTemplate}" />

                <Button Content="{Binding Forecast.CommitLabel}"
                        Command="{Binding Forecast.SaveCommand}"
                        IsEnabled="{Binding Forecast.CanSave}"
                        Style="{StaticResource CardHeaderButtonStyle}"
                        Margin="0,12,0,0"
                        HorizontalAlignment="Left"
                        Padding="16,6"
                        AutomationProperties.Name="Save finance forecast" />

                <TextBlock Text="{Binding Forecast.StatusMessage}"
                           Foreground="{StaticResource NeutralTextBrush}"
                           Margin="0,8,0,0"
                           Visibility="{Binding Forecast.HasStatusMessage, Converter={StaticResource BooleanToVisibilityConverter}}" />
            </StackPanel>
        </DataTemplate>

        <DataTemplate x:Key="ScoutAssignmentsCardBodyTemplate">
            <views:ScoutAssignmentBoardView DataContext="{Binding ScoutAssignments}" />
        </DataTemplate>

        <DataTemplate x:Key="ShortlistBoardCardBodyTemplate">
            <views:ShortlistBoardView DataContext="{Binding ShortlistBoard}" />
        </DataTemplate>

        <DataTemplate x:Key="TimelineCardBodyTemplate">
            <Grid>
                <controls:TimelineControl Items="{Binding TimelineEntries}" MinHeight="190" />
            </Grid>
        </DataTemplate>

        <DataTemplate x:Key="WorkloadHeatmapCardBodyTemplate">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <Grid Grid.Row="0"
                      Margin="0,0,0,12">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="140" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <TextBlock Text="Unit"
                               Foreground="{StaticResource NeutralTextBrush}" />

                    <ItemsControl Grid.Column="1"
                                  ItemsSource="{Binding WorkloadHeatmap.Columns}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Orientation="Horizontal" />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Width="112"
                                        Margin="4,0"
                                        Background="#152032"
                                        BorderBrush="#233246"
                                        BorderThickness="1"
                                        CornerRadius="12">
                                    <TextBlock Text="{Binding}"
                                               Foreground="{StaticResource NeutralTextBrush}"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center"
                                               FontWeight="SemiBold"
                                               Margin="8,6" />
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </Grid>

                <ScrollViewer Grid.Row="1"
                              HorizontalScrollBarVisibility="Auto"
                              VerticalScrollBarVisibility="Auto">
                    <ItemsControl ItemsSource="{Binding WorkloadHeatmap.Rows}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate DataType="{x:Type vm:TrainingWorkloadHeatmapRowViewModel}">
                                <StackPanel Orientation="Horizontal"
                                            Margin="0,4">
                                    <Border Width="140"
                                            Margin="0,0,8,0"
                                            Background="#152032"
                                            BorderBrush="#233246"
                                            BorderThickness="1"
                                            CornerRadius="12"
                                            Padding="12,10">
                                        <TextBlock Text="{Binding Label}"
                                                   Foreground="{StaticResource PrimaryTextBrush}"
                                                   FontWeight="SemiBold" />
                                    </Border>

                                    <ItemsControl ItemsSource="{Binding Cells}">
                                        <ItemsControl.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <StackPanel Orientation="Horizontal" />
                                            </ItemsPanelTemplate>
                                        </ItemsControl.ItemsPanel>
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate DataType="{x:Type vm:TrainingWorkloadHeatmapCellViewModel}">
                                                <Border Width="112"
                                                        Height="72"
                                                        Margin="4,0"
                                                        Background="{Binding BackgroundBrush}"
                                                        CornerRadius="14"
                                                        BorderBrush="#202F43"
                                                        BorderThickness="1"
                                                        ToolTip="{Binding Tooltip}">
                                                    <StackPanel HorizontalAlignment="Center"
                                                                VerticalAlignment="Center">
                                                        <TextBlock Text="{Binding DisplayLoad}"
                                                                   Foreground="White"
                                                                   FontSize="18"
                                                                   FontWeight="SemiBold"
                                                                   HorizontalAlignment="Center" />
                                                        <TextBlock Text="{Binding IntensityDisplay}"
                                                                   Foreground="#E6FFFFFF"
                                                                   FontSize="12"
                                                                   HorizontalAlignment="Center"
                                                                   Margin="0,4,0,0" />
                                                    </StackPanel>
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </StackPanel>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>

                <StackPanel Grid.Row="2"
                            Margin="0,16,0,0"
                            Orientation="Vertical"
                            Visibility="{Binding WorkloadHeatmap.HasLegend, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <TextBlock Text="{Binding WorkloadHeatmap.LegendTitle}"
                               Foreground="{StaticResource PrimaryTextBrush}"
                               FontWeight="SemiBold"
                               Visibility="{Binding WorkloadHeatmap.HasLegendTitle, Converter={StaticResource BooleanToVisibilityConverter}}" />
                    <TextBlock Text="{Binding WorkloadHeatmap.LegendSubtitle}"
                               Foreground="{StaticResource NeutralTextBrush}"
                               Margin="0,4,0,12"
                               Visibility="{Binding WorkloadHeatmap.HasLegendSubtitle, Converter={StaticResource BooleanToVisibilityConverter}}" />

                    <ItemsControl ItemsSource="{Binding WorkloadHeatmap.Intensities}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Orientation="Horizontal" />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate DataType="{x:Type vm:TrainingIntensityLevelViewModel}">
                                <StackPanel Orientation="Horizontal"
                                            Margin="0,0,16,0"
                                            VerticalAlignment="Center">
                                    <Border Width="18"
                                            Height="18"
                                            CornerRadius="4"
                                            Background="{Binding Brush}"
                                            Margin="0,0,8,0" />
                                    <TextBlock Text="{Binding DisplayName}"
                                               Foreground="{StaticResource NeutralTextBrush}" />
                                </StackPanel>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </Grid>
        </DataTemplate>

        <DataTemplate x:Key="FixtureCardBodyTemplate">
            <StackPanel>
                <Border Background="#19202E"
                        CornerRadius="14"
                        Padding="16"
                        Margin="0,0,0,16">
                    <StackPanel>
                        <TextBlock Text="{Binding Description}"
                                   Foreground="White"
                                   FontSize="20"
                                   FontWeight="SemiBold" />
                    </StackPanel>
                </Border>
                <ItemsControl ItemsSource="{Binding ListItems}"
                              ItemTemplate="{StaticResource FixtureListItemTemplate}" />
            </StackPanel>
        </DataTemplate>

        <DataTemplate x:Key="FormationCardBodyTemplate">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <Border Grid.Row="0"
                        Background="#0E4022"
                        CornerRadius="16"
                        Padding="18"
                        BorderBrush="#1ABF8F"
                        BorderThickness="1">
                    <Grid>
                        <Rectangle Height="2"
                                   Fill="#1ABF8F"
                                   Opacity="0.35"
                                   HorizontalAlignment="Stretch"
                                   VerticalAlignment="Center" />

                        <ItemsControl ItemsSource="{Binding FormationPlayers}"
                                      ItemTemplate="{StaticResource FormationPlayerTemplate}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <Canvas />
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemContainerStyle>
                                <Style TargetType="ContentPresenter">
                                    <Setter Property="Canvas.Left">
                                        <Setter.Value>
                                            <MultiBinding Converter="{StaticResource RelativePositionConverter}" ConverterParameter="56">
                                                <Binding Path="NormalizedX" />
                                                <Binding RelativeSource="{RelativeSource AncestorType=Canvas}" Path="ActualWidth" />
                                            </MultiBinding>
                                        </Setter.Value>
                                    </Setter>
                                    <Setter Property="Canvas.Top">
                                        <Setter.Value>
                                            <MultiBinding Converter="{StaticResource RelativePositionConverter}" ConverterParameter="56">
                                                <Binding Path="NormalizedY" />
                                                <Binding RelativeSource="{RelativeSource AncestorType=Canvas}" Path="ActualHeight" />
                                            </MultiBinding>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                            </ItemsControl.ItemContainerStyle>
                        </ItemsControl>
                    </Grid>
                </Border>

                <ItemsControl Grid.Row="1"
                              Margin="0,16,0,0"
                              ItemsSource="{Binding FormationLines}"
                              ItemTemplate="{StaticResource FormationLineTemplate}" />
            </Grid>
        </DataTemplate>

        <DataTemplate DataType="{x:Type editors:FormationEditorViewModel}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <ScrollViewer Grid.Row="0"
                              VerticalScrollBarVisibility="Auto"
                              Margin="0,0,0,16">
                    <StackPanel>
                        <ItemsControl ItemsSource="{Binding Lines}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate DataType="{x:Type editors:FormationLineEditorViewModel}">
                                    <StackPanel Margin="0,0,0,24">
                                        <TextBlock Text="{Binding Role}"
                                                   FontSize="16"
                                                   FontWeight="SemiBold"
                                                   Foreground="{StaticResource PrimaryTextBrush}" />

                                        <ItemsControl Margin="0,12,0,0"
                                                      ItemsSource="{Binding Slots}">
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate DataType="{x:Type editors:FormationSlotEditorViewModel}">
                                                    <StackPanel Margin="0,12,0,0">
                                                        <TextBlock Text="{Binding Label}"
                                                                   FontWeight="SemiBold"
                                                                   Foreground="{StaticResource NeutralTextBrush}" />
                                                        <ComboBox ItemsSource="{Binding AvailablePlayers}"
                                                                  SelectedValue="{Binding SelectedPlayerId, UpdateSourceTrigger=PropertyChanged}"
                                                                  SelectedValuePath="Id"
                                                                  Margin="0,8,0,0"
                                                                  Background="#152032"
                                                                  Foreground="{StaticResource PrimaryTextBrush}"
                                                                  BorderBrush="{StaticResource OverlayListItemBorderBrush}"
                                                                  BorderThickness="1"
                                                                  Padding="8,6"
                                                                  ScrollViewer.VerticalScrollBarVisibility="Auto">
                                                            <ComboBox.ItemTemplate>
                                                                <DataTemplate DataType="{x:Type editors:FormationPlayerOptionViewModel}">
                                                                    <StackPanel>
                                                                        <TextBlock Text="{Binding DisplayName}"
                                                                                   FontWeight="SemiBold"
                                                                                   Foreground="{StaticResource PrimaryTextBrush}" />
                                                                        <StackPanel Orientation="Horizontal"
                                                                                    Margin="0,2,0,0">
                                                                            <TextBlock Text="{Binding Position}"
                                                                                       Foreground="{StaticResource NeutralTextBrush}" />
                                                                            <TextBlock Text="  "
                                                                                       Foreground="{StaticResource NeutralTextBrush}"
                                                                                       Visibility="{Binding Detail, Converter={StaticResource NullToVisibilityConverter}}" />
                                                                            <TextBlock Text="{Binding Detail}"
                                                                                       Foreground="{StaticResource NeutralTextBrush}"
                                                                                       Visibility="{Binding Detail, Converter={StaticResource NullToVisibilityConverter}}" />
                                                                        </StackPanel>
                                                                    </StackPanel>
                                                                </DataTemplate>
                                                            </ComboBox.ItemTemplate>
                                                        </ComboBox>
                                                    </StackPanel>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                    </StackPanel>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </ScrollViewer>

                <Grid Grid.Row="1">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <TextBlock Grid.Column="0"
                               Text="{Binding ValidationMessage}"
                               Foreground="{StaticResource AlertTextBrush}"
                               VerticalAlignment="Center"
                               Margin="0,0,16,0"
                               Visibility="{Binding HasValidationMessage, Converter={StaticResource BooleanToVisibilityConverter}}" />

                    <Button Grid.Column="1"
                            Margin="0,0,12,0"
                            Style="{StaticResource PaletteSecondaryButtonStyle}"
                            Command="{Binding CancelCommand}"
                            Content="Cancel" />

                    <Button Grid.Column="2"
                            Style="{StaticResource PalettePrimaryButtonStyle}"
                            Command="{Binding SaveCommand}"
                            Content="Save Changes" />
                </Grid>
            </Grid>
        </DataTemplate>

        <DataTemplate DataType="{x:Type editors:ListCardEditorViewModel}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <ListBox Grid.Row="0"
                         ItemsSource="{Binding Items}"
                         SelectedItem="{Binding SelectedItem}"
                         behaviors:ListBoxDragReorderBehavior.EnableReorder="True"
                         BorderThickness="1"
                         BorderBrush="{StaticResource OverlayListItemBorderBrush}"
                         Background="{StaticResource OverlayListBackgroundBrush}"
                         Foreground="{StaticResource PrimaryTextBrush}"
                         Margin="0,0,0,12"
                         ScrollViewer.VerticalScrollBarVisibility="Auto">
                    <ListBox.ItemTemplate>
                        <DataTemplate DataType="{x:Type editors:EditableListItemViewModel}">
                            <Border Padding="12"
                                    Margin="0,0,0,10"
                                    Background="{StaticResource OverlayListItemBrush}"
                                    BorderBrush="{StaticResource OverlayListItemBorderBrush}"
                                    BorderThickness="1"
                                    CornerRadius="12">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Row="0"
                                               Grid.Column="0"
                                               Text="Primary"
                                               Foreground="{StaticResource NeutralTextBrush}"
                                               Margin="0,0,12,6" />
                                    <TextBox Grid.Row="0"
                                             Grid.Column="1"
                                             Text="{Binding Primary, UpdateSourceTrigger=PropertyChanged}"
                                             Background="#152032"
                                             Foreground="{StaticResource PrimaryTextBrush}"
                                             BorderBrush="{StaticResource OverlayListItemBorderBrush}"
                                             BorderThickness="1"
                                             Padding="8,4"
                                             MinWidth="220" />

                                    <TextBlock Grid.Row="1"
                                               Grid.Column="0"
                                               Text="Secondary"
                                               Foreground="{StaticResource NeutralTextBrush}"
                                               Margin="0,8,12,6" />
                                    <TextBox Grid.Row="1"
                                             Grid.Column="1"
                                             Margin="0,8,0,0"
                                             Text="{Binding Secondary, UpdateSourceTrigger=PropertyChanged}"
                                             Background="#152032"
                                             Foreground="{StaticResource PrimaryTextBrush}"
                                             BorderBrush="{StaticResource OverlayListItemBorderBrush}"
                                             BorderThickness="1"
                                             Padding="8,4" />

                                    <TextBlock Grid.Row="2"
                                               Grid.Column="0"
                                               Text="Tertiary"
                                               Foreground="{StaticResource NeutralTextBrush}"
                                               Margin="0,8,12,6" />
                                    <TextBox Grid.Row="2"
                                             Grid.Column="1"
                                             Margin="0,8,0,0"
                                             Text="{Binding Tertiary, UpdateSourceTrigger=PropertyChanged}"
                                             Background="#152032"
                                             Foreground="{StaticResource PrimaryTextBrush}"
                                             BorderBrush="{StaticResource OverlayListItemBorderBrush}"
                                             BorderThickness="1"
                                             Padding="8,4" />

                                    <TextBlock Grid.Row="3"
                                               Grid.Column="0"
                                               Text="Accent"
                                               Foreground="{StaticResource NeutralTextBrush}"
                                               Margin="0,8,12,0" />
                                    <TextBox Grid.Row="3"
                                             Grid.Column="1"
                                             Margin="0,8,0,0"
                                             Text="{Binding Accent, UpdateSourceTrigger=PropertyChanged}"
                                             Background="#152032"
                                             Foreground="{StaticResource PrimaryTextBrush}"
                                             BorderBrush="{StaticResource OverlayListItemBorderBrush}"
                                             BorderThickness="1"
                                             Padding="8,4" />
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>

                <StackPanel Grid.Row="1"
                            Orientation="Horizontal"
                            HorizontalAlignment="Right">
                    <Button Style="{StaticResource PalettePrimaryButtonStyle}"
                            Command="{Binding AddItemCommand}"
                            Margin="0,0,12,0"
                            AutomationProperties.Name="Add list item">
                        <AccessText Text="_Add Item" />
                    </Button>
                    <Button Style="{StaticResource PaletteSecondaryButtonStyle}"
                            Command="{Binding RemoveSelectedCommand}"
                            Margin="0,0,12,0"
                            AutomationProperties.Name="Remove selected item">
                        <AccessText Text="_Remove" />
                    </Button>
                    <Button Style="{StaticResource PaletteSecondaryButtonStyle}"
                            Command="{Binding MoveUpCommand}"
                            Margin="0,0,12,0"
                            AutomationProperties.Name="Move item up">
                        <AccessText Text="Move _Up" />
                    </Button>
                    <Button Style="{StaticResource PaletteSecondaryButtonStyle}"
                            Command="{Binding MoveDownCommand}"
                            AutomationProperties.Name="Move item down">
                        <AccessText Text="Move _Down" />
                    </Button>
                </StackPanel>
            </Grid>
        </DataTemplate>

        <DataTemplate DataType="{x:Type editors:TrainingSessionEditorViewModel}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <ListBox Grid.Row="0"
                         ItemsSource="{Binding Sessions}"
                         SelectedItem="{Binding SelectedSession}"
                         behaviors:ListBoxDragReorderBehavior.EnableReorder="True"
                         BorderThickness="1"
                         BorderBrush="{StaticResource OverlayListItemBorderBrush}"
                         Background="{StaticResource OverlayListBackgroundBrush}"
                         Foreground="{StaticResource PrimaryTextBrush}"
                         Margin="0,0,0,12"
                         ScrollViewer.VerticalScrollBarVisibility="Auto">
                    <ListBox.ItemTemplate>
                        <DataTemplate DataType="{x:Type editors:TrainingSessionEditorItemViewModel}">
                            <Border Padding="12"
                                    Margin="0,0,0,10"
                                    Background="{StaticResource OverlayListItemBrush}"
                                    BorderBrush="{StaticResource OverlayListItemBorderBrush}"
                                    BorderThickness="1"
                                    CornerRadius="12">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Row="0"
                                               Grid.Column="0"
                                               Text="Day"
                                               Foreground="{StaticResource NeutralTextBrush}"
                                               Margin="0,0,12,6" />
                                    <ComboBox Grid.Row="0"
                                              Grid.Column="1"
                                              ItemsSource="{Binding DataContext.DayOptions, RelativeSource={RelativeSource AncestorType=ListBox}}"
                                              SelectedItem="{Binding Day, UpdateSourceTrigger=PropertyChanged}"
                                              Background="#152032"
                                              Foreground="{StaticResource PrimaryTextBrush}"
                                              BorderBrush="{StaticResource OverlayListItemBorderBrush}"
                                              BorderThickness="1"
                                              Padding="8,4"
                                              MinWidth="160" />

                                    <TextBlock Grid.Row="0"
                                               Grid.Column="2"
                                               Text="Slot"
                                               Foreground="{StaticResource NeutralTextBrush}"
                                               Margin="24,0,12,6" />
                                    <ComboBox Grid.Row="0"
                                              Grid.Column="3"
                                              ItemsSource="{Binding DataContext.SlotOptions, RelativeSource={RelativeSource AncestorType=ListBox}}"
                                              SelectedItem="{Binding Slot, UpdateSourceTrigger=PropertyChanged}"
                                              Background="#152032"
                                              Foreground="{StaticResource PrimaryTextBrush}"
                                              BorderBrush="{StaticResource OverlayListItemBorderBrush}"
                                              BorderThickness="1"
                                              Padding="8,4"
                                              MinWidth="150" />

                                    <TextBlock Grid.Row="1"
                                               Grid.Column="0"
                                               Grid.ColumnSpan="1"
                                               Text="Activity"
                                               Foreground="{StaticResource NeutralTextBrush}"
                                               Margin="0,12,12,6" />
                                    <TextBox Grid.Row="1"
                                             Grid.Column="1"
                                             Grid.ColumnSpan="3"
                                             Margin="0,12,0,0"
                                             Text="{Binding Activity, UpdateSourceTrigger=PropertyChanged}"
                                             Background="#152032"
                                             Foreground="{StaticResource PrimaryTextBrush}"
                                             BorderBrush="{StaticResource OverlayListItemBorderBrush}"
                                             BorderThickness="1"
                                             Padding="8,4" />

                                    <TextBlock Grid.Row="2"
                                               Grid.Column="0"
                                               Grid.ColumnSpan="1"
                                               Text="Focus"
                                               Foreground="{StaticResource NeutralTextBrush}"
                                               Margin="0,12,12,6" />
                                    <TextBox Grid.Row="2"
                                             Grid.Column="1"
                                             Grid.ColumnSpan="3"
                                             Margin="0,12,0,0"
                                             Text="{Binding Focus, UpdateSourceTrigger=PropertyChanged}"
                                             Background="#152032"
                                             Foreground="{StaticResource PrimaryTextBrush}"
                                             BorderBrush="{StaticResource OverlayListItemBorderBrush}"
                                             BorderThickness="1"
                                             Padding="8,4" />

                                    <TextBlock Grid.Row="3"
                                               Grid.Column="0"
                                               Grid.ColumnSpan="1"
                                               Text="Intensity"
                                               Foreground="{StaticResource NeutralTextBrush}"
                                               Margin="0,12,12,0" />
                                    <TextBox Grid.Row="3"
                                             Grid.Column="1"
                                             Grid.ColumnSpan="3"
                                             Margin="0,12,0,0"
                                             Text="{Binding Intensity, UpdateSourceTrigger=PropertyChanged}"
                                             Background="#152032"
                                             Foreground="{StaticResource PrimaryTextBrush}"
                                             BorderBrush="{StaticResource OverlayListItemBorderBrush}"
                                             BorderThickness="1"
                                             Padding="8,4" />
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>

                <StackPanel Grid.Row="1"
                            Orientation="Horizontal"
                            HorizontalAlignment="Right">
                    <Button Style="{StaticResource PalettePrimaryButtonStyle}"
                            Command="{Binding AddSessionCommand}"
                            Margin="0,0,12,0"
                            Content="Add Session" />
                    <Button Style="{StaticResource PaletteSecondaryButtonStyle}"
                            Command="{Binding RemoveSessionCommand}"
                            Margin="0,0,12,0"
                            Content="Remove" />
                    <Button Style="{StaticResource PaletteSecondaryButtonStyle}"
                            Command="{Binding MoveUpCommand}"
                            Margin="0,0,12,0"
                            Content="Move Up" />
                    <Button Style="{StaticResource PaletteSecondaryButtonStyle}"
                            Command="{Binding MoveDownCommand}"
                            Content="Move Down" />
                </StackPanel>
            </Grid>
        </DataTemplate>

        <DataTemplate DataType="{x:Type editors:GaugeEditorViewModel}">
            <StackPanel>
                <TextBlock Text="Adjust the value and target for this gauge"
                           Foreground="{StaticResource NeutralTextBrush}"
                           Margin="0,0,0,12" />

                <StackPanel Margin="0,0,0,12">
                    <TextBlock Text="Current Value"
                               Foreground="{StaticResource PrimaryTextBrush}"
                               FontWeight="SemiBold" />
                    <Slider Minimum="{Binding Minimum}"
                            Maximum="{Binding Maximum}"
                            Value="{Binding Value, Mode=TwoWay}"
                            Margin="0,8,0,4"
                            TickFrequency="1"
                            IsSnapToTickEnabled="False" />
                    <TextBlock Text="{Binding Value, StringFormat=Current: {0:0.##}}"
                               Foreground="{StaticResource NeutralTextBrush}" />
                </StackPanel>

                <StackPanel Margin="0,0,0,16">
                    <TextBlock Text="Target"
                               Foreground="{StaticResource PrimaryTextBrush}"
                               FontWeight="SemiBold" />
                    <Slider Minimum="{Binding Minimum}"
                            Maximum="{Binding Maximum}"
                            Value="{Binding Target, Mode=TwoWay}"
                            Margin="0,8,0,4"
                            TickFrequency="1"
                            IsSnapToTickEnabled="False" />
                    <TextBlock Text="{Binding Target, StringFormat=Target: {0:0.##}}"
                               Foreground="{StaticResource NeutralTextBrush}" />
                </StackPanel>

                <TextBlock Text="Displayed Value"
                           Foreground="{StaticResource PrimaryTextBrush}"
                           FontWeight="SemiBold" />
                <TextBox Text="{Binding DisplayValue, UpdateSourceTrigger=PropertyChanged}"
                         Margin="0,6,0,16"
                         Background="#152032"
                         Foreground="{StaticResource PrimaryTextBrush}"
                         BorderBrush="{StaticResource OverlayListItemBorderBrush}"
                         BorderThickness="1"
                         Padding="10,6" />

                <TextBlock Text="Summary"
                           Foreground="{StaticResource PrimaryTextBrush}"
                           FontWeight="SemiBold" />
                <TextBox Text="{Binding Summary, UpdateSourceTrigger=PropertyChanged}"
                         Margin="0,6,0,16"
                         Background="#152032"
                         Foreground="{StaticResource PrimaryTextBrush}"
                         BorderBrush="{StaticResource OverlayListItemBorderBrush}"
                         BorderThickness="1"
                         Padding="10,6"
                         AcceptsReturn="True"
                         TextWrapping="Wrap"
                         MinHeight="70" />

                <TextBlock Text="Pill Label"
                           Foreground="{StaticResource PrimaryTextBrush}"
                           FontWeight="SemiBold" />
                <TextBox Text="{Binding Pill, UpdateSourceTrigger=PropertyChanged}"
                         Margin="0,6,0,0"
                         Background="#152032"
                         Foreground="{StaticResource PrimaryTextBrush}"
                         BorderBrush="{StaticResource OverlayListItemBorderBrush}"
                         BorderThickness="1"
                         Padding="10,6" />

                <TextBlock Text="{Binding Unit, StringFormat=Unit: {0}}"
                           Foreground="{StaticResource NeutralTextBrush}"
                           Margin="0,12,0,0" />
            </StackPanel>
        </DataTemplate>

        <DataTemplate DataType="{x:Type editors:TransferNegotiationEditorViewModel}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <Grid Grid.Row="0" ColumnSpacing="24">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="260" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <Border Grid.Column="0"
                            Background="{StaticResource OverlayListBackgroundBrush}"
                            BorderBrush="{StaticResource OverlayListItemBorderBrush}"
                            BorderThickness="1"
                            CornerRadius="16"
                            Padding="0">
                        <ListBox ItemsSource="{Binding Deals}"
                                 SelectedItem="{Binding SelectedDeal, Mode=TwoWay}"
                                 BorderThickness="0"
                                 Background="Transparent"
                                 Foreground="{StaticResource PrimaryTextBrush}"
                                 ScrollViewer.VerticalScrollBarVisibility="Auto">
                            <ListBox.ItemTemplate>
                                <DataTemplate DataType="{x:Type editors:TransferNegotiationDealEditorViewModel}">
                                    <Border Margin="8"
                                            Padding="10"
                                            Background="#152032"
                                            BorderBrush="{StaticResource OverlayListItemBorderBrush}"
                                            BorderThickness="1"
                                            CornerRadius="12">
                                        <StackPanel>
                                            <TextBlock Text="{Binding Player}"
                                                       Foreground="{StaticResource PrimaryTextBrush}"
                                                       FontWeight="SemiBold" />
                                            <TextBlock Text="{Binding Club}"
                                                       Foreground="{StaticResource NeutralTextBrush}"
                                                       FontSize="12"
                                                       Margin="0,4,0,6" />
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="{Binding Stage}"
                                                           Foreground="{StaticResource NeutralTextBrush}"
                                                           FontSize="11" />
                                                <TextBlock Text="  "
                                                           Margin="4,0"
                                                           Foreground="{StaticResource NeutralTextBrush}" />
                                                <TextBlock Text="{Binding Status}"
                                                           Foreground="{StaticResource NeutralTextBrush}"
                                                           FontSize="11" />
                                            </StackPanel>
                                        </StackPanel>
                                    </Border>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </Border>

                    <Border Grid.Column="1"
                            Background="{StaticResource OverlayListBackgroundBrush}"
                            BorderBrush="{StaticResource OverlayListItemBorderBrush}"
                            BorderThickness="1"
                            CornerRadius="16"
                            Padding="20">
                        <ContentControl Content="{Binding SelectedDeal}">
                            <ContentControl.Resources>
                                <DataTemplate DataType="{x:Type editors:TransferNegotiationDealEditorViewModel}">
                                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                                        <StackPanel>
                                            <Grid Margin="0,0,0,18">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*" />
                                                    <ColumnDefinition Width="Auto" />
                                                </Grid.ColumnDefinitions>

                                                <StackPanel Grid.Column="0">
                                                    <TextBlock Text="Player"
                                                               Foreground="{StaticResource PrimaryTextBrush}"
                                                               FontWeight="SemiBold" />
                                                    <TextBox Text="{Binding Player, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                             Margin="0,6,0,0"
                                                             Background="#152032"
                                                             Foreground="{StaticResource PrimaryTextBrush}"
                                                             BorderBrush="{StaticResource OverlayListItemBorderBrush}"
                                                             BorderThickness="1"
                                                             Padding="10,6"
                                                             FontSize="18"
                                                             FontWeight="SemiBold" />
                                                </StackPanel>

                                                <Button Grid.Column="1"
                                                        Margin="16,24,0,0"
                                                        Style="{StaticResource PaletteSecondaryButtonStyle}"
                                                        Command="{Binding ResetCommand}"
                                                        Content="Reset Deal"
                                                        IsEnabled="{Binding IsDirty}" />
                                            </Grid>

                                            <Grid Margin="0,0,0,18">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*" />
                                                    <ColumnDefinition Width="*" />
                                                </Grid.ColumnDefinitions>

                                                <StackPanel Grid.Column="0" Margin="0,0,12,0">
                                                    <TextBlock Text="Position"
                                                               Foreground="{StaticResource PrimaryTextBrush}"
                                                               FontWeight="SemiBold" />
                                                    <TextBox Text="{Binding Position, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                             Margin="0,6,0,0"
                                                             Background="#152032"
                                                             Foreground="{StaticResource PrimaryTextBrush}"
                                                             BorderBrush="{StaticResource OverlayListItemBorderBrush}"
                                                             BorderThickness="1"
                                                             Padding="10,6" />
                                                </StackPanel>

                                                <StackPanel Grid.Column="1">
                                                    <TextBlock Text="Club"
                                                               Foreground="{StaticResource PrimaryTextBrush}"
                                                               FontWeight="SemiBold" />
                                                    <TextBox Text="{Binding Club, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                             Margin="0,6,0,0"
                                                             Background="#152032"
                                                             Foreground="{StaticResource PrimaryTextBrush}"
                                                             BorderBrush="{StaticResource OverlayListItemBorderBrush}"
                                                             BorderThickness="1"
                                                             Padding="10,6" />
                                                </StackPanel>
                                            </Grid>

                                            <StackPanel Margin="0,0,0,18">
                                                <TextBlock Text="Accent Tag"
                                                           Foreground="{StaticResource PrimaryTextBrush}"
                                                           FontWeight="SemiBold" />
                                                <TextBox Text="{Binding Accent, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                         Margin="0,6,0,0"
                                                         Background="#152032"
                                                         Foreground="{StaticResource PrimaryTextBrush}"
                                                         BorderBrush="{StaticResource OverlayListItemBorderBrush}"
                                                         BorderThickness="1"
                                                         Padding="10,6" />
                                            </StackPanel>

                                            <TextBlock Text="Stage"
                                                       Foreground="{StaticResource PrimaryTextBrush}"
                                                       FontWeight="SemiBold" />
                                            <ComboBox ItemsSource="{Binding StageOptions}"
                                                      SelectedItem="{Binding Stage, Mode=TwoWay}"
                                                      IsEditable="True"
                                                      Background="#152032"
                                                      Foreground="{StaticResource PrimaryTextBrush}"
                                                      BorderBrush="{StaticResource OverlayListItemBorderBrush}"
                                                      Margin="0,6,0,16" />

                                            <TextBlock Text="Status"
                                                       Foreground="{StaticResource PrimaryTextBrush}"
                                                       FontWeight="SemiBold" />
                                            <ComboBox ItemsSource="{Binding StatusOptions}"
                                                      SelectedItem="{Binding Status, Mode=TwoWay}"
                                                      IsEditable="True"
                                                      Background="#152032"
                                                      Foreground="{StaticResource PrimaryTextBrush}"
                                                      BorderBrush="{StaticResource OverlayListItemBorderBrush}"
                                                      Margin="0,6,0,16" />

                                            <TextBlock Text="Deadline"
                                                       Foreground="{StaticResource PrimaryTextBrush}"
                                                       FontWeight="SemiBold" />
                                            <TextBox Text="{Binding Deadline, UpdateSourceTrigger=PropertyChanged}"
                                                     Margin="0,6,0,16"
                                                     Background="#152032"
                                                     Foreground="{StaticResource PrimaryTextBrush}"
                                                     BorderBrush="{StaticResource OverlayListItemBorderBrush}"
                                                     Padding="10,6" />

                                            <TextBlock Text="Summary"
                                                       Foreground="{StaticResource PrimaryTextBrush}"
                                                       FontWeight="SemiBold" />
                                            <TextBox Text="{Binding Summary, UpdateSourceTrigger=PropertyChanged}"
                                                     Margin="0,6,0,16"
                                                     Background="#152032"
                                                     Foreground="{StaticResource PrimaryTextBrush}"
                                                     BorderBrush="{StaticResource OverlayListItemBorderBrush}"
                                                     Padding="10,6"
                                                     AcceptsReturn="True"
                                                     TextWrapping="Wrap"
                                                     MinHeight="60" />

                                            <TextBlock Text="Agent"
                                                       Foreground="{StaticResource PrimaryTextBrush}"
                                                       FontWeight="SemiBold" />
                                            <TextBox Text="{Binding Agent, UpdateSourceTrigger=PropertyChanged}"
                                                     Margin="0,6,0,16"
                                                     Background="#152032"
                                                     Foreground="{StaticResource PrimaryTextBrush}"
                                                     BorderBrush="{StaticResource OverlayListItemBorderBrush}"
                                                     Padding="10,6" />

                                            <TextBlock Text="Latest Response"
                                                       Foreground="{StaticResource PrimaryTextBrush}"
                                                       FontWeight="SemiBold" />
                                            <TextBox Text="{Binding Response, UpdateSourceTrigger=PropertyChanged}"
                                                     Margin="0,6,0,20"
                                                     Background="#152032"
                                                     Foreground="{StaticResource PrimaryTextBrush}"
                                                     BorderBrush="{StaticResource OverlayListItemBorderBrush}"
                                                     Padding="10,6"
                                                     AcceptsReturn="True"
                                                     TextWrapping="Wrap"
                                                     MinHeight="70" />

                                            <TextBlock Text="Offer Terms"
                                                       Foreground="{StaticResource PrimaryTextBrush}"
                                                       FontWeight="SemiBold"
                                                       Margin="0,0,0,12" />

                                            <ItemsControl ItemsSource="{Binding Terms}">
                                                <ItemsControl.ItemsPanel>
                                                    <ItemsPanelTemplate>
                                                        <WrapPanel />
                                                    </ItemsPanelTemplate>
                                                </ItemsControl.ItemsPanel>
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate DataType="{x:Type editors:TransferNegotiationTermEditorViewModel}">
                                                        <Border Width="240"
                                                                Margin="0,0,16,16"
                                                                Background="#152032"
                                                                BorderBrush="{StaticResource OverlayListItemBorderBrush}"
                                                                BorderThickness="1"
                                                                CornerRadius="16"
                                                                Padding="14">
                                                            <StackPanel>
                                                                <TextBlock Text="{Binding Label}"
                                                                           Foreground="{StaticResource PrimaryTextBrush}"
                                                                           FontWeight="SemiBold" />
                                                                <Slider Minimum="{Binding Minimum}"
                                                                        Maximum="{Binding Maximum}"
                                                                        Value="{Binding Value, Mode=TwoWay}"
                                                                        TickFrequency="{Binding TickFrequency}"
                                                                        IsSnapToTickEnabled="True"
                                                                        Margin="0,10,0,4" />
                                                                <StackPanel Orientation="Horizontal"
                                                                            Margin="0,4,0,0">
                                                                    <TextBlock Text="{Binding DisplayValue}"
                                                                               Foreground="{StaticResource PrimaryTextBrush}"
                                                                               FontWeight="SemiBold" />
                                                                    <TextBlock Text=" / "
                                                                               Foreground="{StaticResource NeutralTextBrush}"
                                                                               Margin="6,0" />
                                                                    <TextBlock Text="{Binding TargetDisplay}"
                                                                               Foreground="{StaticResource NeutralTextBrush}" />
                                                                </StackPanel>
                                                                <TextBlock Text="{Binding DeltaDisplay}"
                                                                           Margin="0,6,0,0">
                                                                    <TextBlock.Style>
                                                                        <Style TargetType="TextBlock">
                                                                            <Setter Property="Foreground" Value="{StaticResource AccentSecondaryBrush}" />
                                                                            <Style.Triggers>
                                                                                <DataTrigger Binding="{Binding MeetsTarget}" Value="False">
                                                                                    <Setter Property="Foreground" Value="{StaticResource AlertTextBrush}" />
                                                                                </DataTrigger>
                                                                            </Style.Triggers>
                                                                        </Style>
                                                                    </TextBlock.Style>
                                                                </TextBlock>
                                                                <Button Style="{StaticResource PaletteSecondaryButtonStyle}"
                                                                        Command="{Binding ResetCommand}"
                                                                        Content="Reset term"
                                                                        Margin="0,10,0,0"
                                                                        IsEnabled="{Binding IsDirty}" />
                                                            </StackPanel>
                                                        </Border>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                        </StackPanel>
                                    </ScrollViewer>
                                </DataTemplate>
                                <DataTemplate DataType="{x:Null}">
                                    <Border Padding="16"
                                            Background="#152032"
                                            CornerRadius="12">
                                        <TextBlock Text="Select a negotiation to edit."
                                                   Foreground="{StaticResource NeutralTextBrush}"
                                                   FontStyle="Italic" />
                                    </Border>
                                </DataTemplate>
                            </ContentControl.Resources>
                        </ContentControl>
                    </Border>
                </Grid>

                <Grid Grid.Row="1">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <TextBlock Grid.Column="0"
                               Text="{Binding ValidationMessage}"
                               Foreground="{StaticResource AlertTextBrush}"
                               VerticalAlignment="Center"
                               Margin="0,0,16,0"
                               Visibility="{Binding HasValidationMessage, Converter={StaticResource BooleanToVisibilityConverter}}" />

                    <Button Grid.Column="1"
                            Margin="0,0,12,0"
                            Style="{StaticResource PaletteSecondaryButtonStyle}"
                            Command="{Binding AddDealCommand}"
                            Content="Add Negotiation" />

                    <Button Grid.Column="2"
                            Margin="0,0,12,0"
                            Style="{StaticResource PaletteSecondaryButtonStyle}"
                            Command="{Binding RemoveSelectedDealCommand}"
                            Content="Remove"
                            ToolTip="Remove the selected negotiation" />

                    <Button Grid.Column="3"
                            Margin="0,0,12,0"
                            Style="{StaticResource PaletteSecondaryButtonStyle}"
                            Command="{Binding CancelCommand}"
                            Content="Cancel" />

                    <Button Grid.Column="4"
                            Style="{StaticResource PalettePrimaryButtonStyle}"
                            Command="{Binding SaveCommand}"
                            Content="Save Changes" />
                </Grid>
            </Grid>
        </DataTemplate>

        <DataTemplate DataType="{x:Type editors:ScoutAssignmentEditorViewModel}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <ListBox Grid.Row="0"
                         ItemsSource="{Binding Assignments}"
                         SelectedItem="{Binding SelectedAssignment}"
                         behaviors:ListBoxDragReorderBehavior.EnableReorder="True"
                         BorderThickness="1"
                         BorderBrush="{StaticResource OverlayListItemBorderBrush}"
                         Background="{StaticResource OverlayListBackgroundBrush}"
                         Foreground="{StaticResource PrimaryTextBrush}"
                         Margin="0,0,0,12"
                         ScrollViewer.VerticalScrollBarVisibility="Auto">
                    <ListBox.ItemTemplate>
                        <DataTemplate DataType="{x:Type editors:ScoutAssignmentEditorItemViewModel}">
                            <Border Padding="14"
                                    Margin="0,0,0,12"
                                    Background="{StaticResource OverlayListItemBrush}"
                                    BorderBrush="{StaticResource OverlayListItemBorderBrush}"
                                    BorderThickness="1"
                                    CornerRadius="12">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="1"
                                               Text="Focus"
                                               Foreground="{StaticResource NeutralTextBrush}" />
                                    <TextBox Grid.Row="0" Grid.Column="1" Grid.ColumnSpan="3"
                                             Margin="12,0,0,0"
                                             Text="{Binding Focus, UpdateSourceTrigger=PropertyChanged}"
                                             Background="#152032"
                                             Foreground="{StaticResource PrimaryTextBrush}"
                                             BorderBrush="{StaticResource OverlayListItemBorderBrush}"
                                             BorderThickness="1"
                                             Padding="8,4" />

                                    <TextBlock Grid.Row="1" Grid.Column="0"
                                               Margin="0,8,0,0"
                                               Text="Role"
                                               Foreground="{StaticResource NeutralTextBrush}" />
                                    <TextBox Grid.Row="1" Grid.Column="1"
                                             Margin="12,8,12,0"
                                             Text="{Binding Role, UpdateSourceTrigger=PropertyChanged}"
                                             Background="#152032"
                                             Foreground="{StaticResource PrimaryTextBrush}"
                                             BorderBrush="{StaticResource OverlayListItemBorderBrush}"
                                             BorderThickness="1"
                                             Padding="8,4" />

                                    <TextBlock Grid.Row="1" Grid.Column="2"
                                               Margin="0,8,0,0"
                                               Text="Region"
                                               Foreground="{StaticResource NeutralTextBrush}" />
                                    <TextBox Grid.Row="1" Grid.Column="3"
                                             Margin="12,8,0,0"
                                             Text="{Binding Region, UpdateSourceTrigger=PropertyChanged}"
                                             Background="#152032"
                                             Foreground="{StaticResource PrimaryTextBrush}"
                                             BorderBrush="{StaticResource OverlayListItemBorderBrush}"
                                             BorderThickness="1"
                                             Padding="8,4" />

                                    <TextBlock Grid.Row="2" Grid.Column="0"
                                               Margin="0,8,0,0"
                                               Text="Stage"
                                               Foreground="{StaticResource NeutralTextBrush}" />
                                    <ComboBox Grid.Row="2" Grid.Column="1"
                                              Margin="12,8,12,0"
                                              ItemsSource="{Binding DataContext.StageOptions, RelativeSource={RelativeSource AncestorType=ListBox}}"
                                              SelectedItem="{Binding Stage, UpdateSourceTrigger=PropertyChanged}"
                                              Background="#152032"
                                              Foreground="{StaticResource PrimaryTextBrush}"
                                              BorderBrush="{StaticResource OverlayListItemBorderBrush}"
                                              BorderThickness="1"
                                              Padding="6,2"
                                              IsEditable="True" />

                                    <TextBlock Grid.Row="2" Grid.Column="2"
                                               Margin="0,8,0,0"
                                               Text="Priority"
                                               Foreground="{StaticResource NeutralTextBrush}" />
                                    <ComboBox Grid.Row="2" Grid.Column="3"
                                              Margin="12,8,0,0"
                                              ItemsSource="{Binding DataContext.PriorityOptions, RelativeSource={RelativeSource AncestorType=ListBox}}"
                                              SelectedItem="{Binding Priority, UpdateSourceTrigger=PropertyChanged}"
                                              Background="#152032"
                                              Foreground="{StaticResource PrimaryTextBrush}"
                                              BorderBrush="{StaticResource OverlayListItemBorderBrush}"
                                              BorderThickness="1"
                                              Padding="6,2"
                                              IsEditable="True" />

                                    <TextBlock Grid.Row="3" Grid.Column="0"
                                               Margin="0,8,0,0"
                                               Text="Deadline"
                                               Foreground="{StaticResource NeutralTextBrush}" />
                                    <TextBox Grid.Row="3" Grid.Column="1"
                                             Margin="12,8,12,0"
                                             Text="{Binding Deadline, UpdateSourceTrigger=PropertyChanged}"
                                             Background="#152032"
                                             Foreground="{StaticResource PrimaryTextBrush}"
                                             BorderBrush="{StaticResource OverlayListItemBorderBrush}"
                                             BorderThickness="1"
                                             Padding="8,4" />

                                    <TextBlock Grid.Row="3" Grid.Column="2"
                                               Margin="0,8,0,0"
                                               Text="Scout"
                                               Foreground="{StaticResource NeutralTextBrush}" />
                                    <ComboBox Grid.Row="3" Grid.Column="3"
                                              Margin="12,8,0,0"
                                              ItemsSource="{Binding DataContext.ScoutOptions, RelativeSource={RelativeSource AncestorType=ListBox}}"
                                              DisplayMemberPath="Display"
                                              SelectedValuePath="Name"
                                              SelectedValue="{Binding Scout, UpdateSourceTrigger=PropertyChanged}"
                                              Background="#152032"
                                              Foreground="{StaticResource PrimaryTextBrush}"
                                              BorderBrush="{StaticResource OverlayListItemBorderBrush}"
                                              BorderThickness="1"
                                              Padding="6,2"
                                              IsEditable="True" />

                                    <TextBlock Grid.Row="4" Grid.Column="0"
                                               Margin="0,10,0,0"
                                               Text="Notes"
                                               Foreground="{StaticResource NeutralTextBrush}" />
                                    <TextBox Grid.Row="4" Grid.Column="1" Grid.ColumnSpan="3"
                                             Margin="12,10,0,0"
                                             Text="{Binding Notes, UpdateSourceTrigger=PropertyChanged}"
                                             Background="#152032"
                                             Foreground="{StaticResource PrimaryTextBrush}"
                                             BorderBrush="{StaticResource OverlayListItemBorderBrush}"
                                             BorderThickness="1"
                                             Padding="8,6"
                                             AcceptsReturn="True"
                                             TextWrapping="Wrap"
                                             MinHeight="60" />
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>

                <StackPanel Grid.Row="1"
                            Orientation="Horizontal"
                            HorizontalAlignment="Right">
                    <Button Style="{StaticResource PalettePrimaryButtonStyle}"
                            Command="{Binding AddAssignmentCommand}"
                            Margin="0,0,12,0"
                            AutomationProperties.Name="Add scout assignment">
                        <AccessText Text="_Add Assignment" />
                    </Button>
                    <Button Style="{StaticResource PaletteSecondaryButtonStyle}"
                            Command="{Binding RemoveAssignmentCommand}"
                            Margin="0,0,12,0"
                            AutomationProperties.Name="Remove scout assignment">
                        <AccessText Text="_Remove" />
                    </Button>
                    <Button Style="{StaticResource PaletteSecondaryButtonStyle}"
                            Command="{Binding MoveUpCommand}"
                            Margin="0,0,12,0"
                            AutomationProperties.Name="Move assignment up">
                        <AccessText Text="Move _Up" />
                    </Button>
                    <Button Style="{StaticResource PaletteSecondaryButtonStyle}"
                            Command="{Binding MoveDownCommand}"
                            AutomationProperties.Name="Move assignment down">
                        <AccessText Text="Move _Down" />
                    </Button>
                </StackPanel>
            </Grid>
        </DataTemplate>

        <DataTemplate DataType="{x:Type editors:ShortlistEditorViewModel}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <ListBox Grid.Row="0"
                         ItemsSource="{Binding Players}"
                         SelectedItem="{Binding SelectedPlayer}"
                         behaviors:ListBoxDragReorderBehavior.EnableReorder="True"
                         BorderThickness="1"
                         BorderBrush="{StaticResource OverlayListItemBorderBrush}"
                         Background="{StaticResource OverlayListBackgroundBrush}"
                         Foreground="{StaticResource PrimaryTextBrush}"
                         Margin="0,0,0,12"
                         ScrollViewer.VerticalScrollBarVisibility="Auto">
                    <ListBox.ItemTemplate>
                        <DataTemplate DataType="{x:Type editors:ShortlistEditorItemViewModel}">
                            <Border Padding="14"
                                    Margin="0,0,0,12"
                                    Background="{StaticResource OverlayListItemBrush}"
                                    BorderBrush="{StaticResource OverlayListItemBorderBrush}"
                                    BorderThickness="1"
                                    CornerRadius="12">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Row="0" Grid.Column="0"
                                               Text="Name"
                                               Foreground="{StaticResource NeutralTextBrush}" />
                                    <TextBox Grid.Row="0" Grid.Column="1"
                                             Margin="12,0,12,0"
                                             Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}"
                                             Background="#152032"
                                             Foreground="{StaticResource PrimaryTextBrush}"
                                             BorderBrush="{StaticResource OverlayListItemBorderBrush}"
                                             BorderThickness="1"
                                             Padding="8,4" />

                                    <TextBlock Grid.Row="0" Grid.Column="2"
                                               Text="Position"
                                               Foreground="{StaticResource NeutralTextBrush}" />
                                    <TextBox Grid.Row="0" Grid.Column="3"
                                             Margin="12,0,0,0"
                                             Text="{Binding Position, UpdateSourceTrigger=PropertyChanged}"
                                             Background="#152032"
                                             Foreground="{StaticResource PrimaryTextBrush}"
                                             BorderBrush="{StaticResource OverlayListItemBorderBrush}"
                                             BorderThickness="1"
                                             Padding="8,4" />

                                    <TextBlock Grid.Row="1" Grid.Column="0"
                                               Margin="0,8,0,0"
                                               Text="Status"
                                               Foreground="{StaticResource NeutralTextBrush}" />
                                    <ComboBox Grid.Row="1" Grid.Column="1"
                                              Margin="12,8,12,0"
                                              ItemsSource="{Binding DataContext.StatusOptions, RelativeSource={RelativeSource AncestorType=ListBox}}"
                                              SelectedItem="{Binding Status, UpdateSourceTrigger=PropertyChanged}"
                                              Background="#152032"
                                              Foreground="{StaticResource PrimaryTextBrush}"
                                              BorderBrush="{StaticResource OverlayListItemBorderBrush}"
                                              BorderThickness="1"
                                              Padding="6,2"
                                              IsEditable="True" />

                                    <TextBlock Grid.Row="1" Grid.Column="2"
                                               Margin="0,8,0,0"
                                               Text="Action"
                                               Foreground="{StaticResource NeutralTextBrush}" />
                                    <ComboBox Grid.Row="1" Grid.Column="3"
                                              Margin="12,8,0,0"
                                              ItemsSource="{Binding DataContext.ActionOptions, RelativeSource={RelativeSource AncestorType=ListBox}}"
                                              SelectedItem="{Binding Action, UpdateSourceTrigger=PropertyChanged}"
                                              Background="#152032"
                                              Foreground="{StaticResource PrimaryTextBrush}"
                                              BorderBrush="{StaticResource OverlayListItemBorderBrush}"
                                              BorderThickness="1"
                                              Padding="6,2"
                                              IsEditable="True" />

                                    <TextBlock Grid.Row="2" Grid.Column="0"
                                               Margin="0,8,0,0"
                                               Text="Priority"
                                               Foreground="{StaticResource NeutralTextBrush}" />
                                    <TextBox Grid.Row="2" Grid.Column="1"
                                             Margin="12,8,12,0"
                                             Text="{Binding Priority, UpdateSourceTrigger=PropertyChanged}"
                                             Background="#152032"
                                             Foreground="{StaticResource PrimaryTextBrush}"
                                             BorderBrush="{StaticResource OverlayListItemBorderBrush}"
                                             BorderThickness="1"
                                             Padding="8,4" />

                                    <TextBlock Grid.Row="2" Grid.Column="2"
                                               Margin="0,8,0,0"
                                               Text="Notes"
                                               Foreground="{StaticResource NeutralTextBrush}" />
                                    <TextBox Grid.Row="2" Grid.Column="3"
                                             Margin="12,8,0,0"
                                             Text="{Binding Notes, UpdateSourceTrigger=PropertyChanged}"
                                             Background="#152032"
                                             Foreground="{StaticResource PrimaryTextBrush}"
                                             BorderBrush="{StaticResource OverlayListItemBorderBrush}"
                                             BorderThickness="1"
                                             Padding="8,6"
                                             AcceptsReturn="True"
                                             TextWrapping="Wrap"
                                             MinHeight="50" />
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>

                <StackPanel Grid.Row="1"
                            Orientation="Horizontal"
                            HorizontalAlignment="Right">
                    <Button Style="{StaticResource PalettePrimaryButtonStyle}"
                            Command="{Binding AddPlayerCommand}"
                            Margin="0,0,12,0"
                            AutomationProperties.Name="Add shortlist player">
                        <AccessText Text="_Add Player" />
                    </Button>
                    <Button Style="{StaticResource PaletteSecondaryButtonStyle}"
                            Command="{Binding RemovePlayerCommand}"
                            Margin="0,0,12,0"
                            AutomationProperties.Name="Remove shortlist player">
                        <AccessText Text="_Remove" />
                    </Button>
                    <Button Style="{StaticResource PaletteSecondaryButtonStyle}"
                            Command="{Binding MoveUpCommand}"
                            Margin="0,0,12,0"
                            AutomationProperties.Name="Move player up">
                        <AccessText Text="Move _Up" />
                    </Button>
                    <Button Style="{StaticResource PaletteSecondaryButtonStyle}"
                            Command="{Binding MoveDownCommand}"
                            AutomationProperties.Name="Move player down">
                        <AccessText Text="Move _Down" />
                    </Button>
                </StackPanel>
            </Grid>
        </DataTemplate>

        <DataTemplate DataType="{x:Type editors:TrainingWorkloadEditorViewModel}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <ScrollViewer Grid.Row="0"
                              VerticalScrollBarVisibility="Auto"
                              Margin="0,0,0,16">
                    <StackPanel>
                        <TextBlock Text="Legend Title"
                                   Foreground="{StaticResource PrimaryTextBrush}" />
                        <TextBox Text="{Binding LegendTitle, UpdateSourceTrigger=PropertyChanged}"
                                 Margin="0,6,0,12"
                                 Background="#152032"
                                 Foreground="{StaticResource PrimaryTextBrush}"
                                 BorderBrush="{StaticResource OverlayListItemBorderBrush}"
                                 BorderThickness="1"
                                 Padding="8,6" />

                        <TextBlock Text="Legend Subtitle"
                                   Foreground="{StaticResource PrimaryTextBrush}" />
                        <TextBox Text="{Binding LegendSubtitle, UpdateSourceTrigger=PropertyChanged}"
                                 Margin="0,6,0,20"
                                 Background="#152032"
                                 Foreground="{StaticResource PrimaryTextBrush}"
                                 BorderBrush="{StaticResource OverlayListItemBorderBrush}"
                                 BorderThickness="1"
                                 Padding="8,6"
                                 AcceptsReturn="True"
                                 TextWrapping="Wrap"
                                 MinHeight="60" />

                        <ItemsControl ItemsSource="{Binding Rows}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate DataType="{x:Type editors:TrainingWorkloadEditorRowViewModel}">
                                    <Border Margin="0,0,0,18"
                                            Padding="16"
                                            Background="{StaticResource OverlayListBackgroundBrush}"
                                            BorderBrush="{StaticResource OverlayListItemBorderBrush}"
                                            BorderThickness="1"
                                            CornerRadius="16">
                                        <StackPanel>
                                            <TextBlock Text="Unit"
                                                       Foreground="{StaticResource NeutralTextBrush}" />
                                            <TextBox Text="{Binding Label, UpdateSourceTrigger=PropertyChanged}"
                                                     Margin="0,6,0,12"
                                                     Background="#152032"
                                                     Foreground="{StaticResource PrimaryTextBrush}"
                                                     BorderBrush="{StaticResource OverlayListItemBorderBrush}"
                                                     BorderThickness="1"
                                                     Padding="8,6" />

                                            <ItemsControl ItemsSource="{Binding Cells}">
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate DataType="{x:Type editors:TrainingWorkloadEditorCellViewModel}">
                                                        <Border Margin="0,0,0,14"
                                                                Padding="12"
                                                                Background="#101723"
                                                                BorderBrush="#1F2B3A"
                                                                BorderThickness="1"
                                                                CornerRadius="12">
                                                            <StackPanel>
                                                                <TextBlock Text="{Binding Column}"
                                                                           Foreground="{StaticResource NeutralTextBrush}" />
                                                                <ComboBox ItemsSource="{Binding IntensityOptions}"
                                                                          SelectedItem="{Binding SelectedIntensity, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                                          DisplayMemberPath="DisplayName"
                                                                          Margin="0,6,0,12"
                                                                          Background="#152032"
                                                                          Foreground="{StaticResource PrimaryTextBrush}"
                                                                          BorderBrush="{StaticResource OverlayListItemBorderBrush}"
                                                                          BorderThickness="1"
                                                                          Padding="8,4" />

                                                                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                                    <TextBlock Text="Load"
                                                                               Foreground="{StaticResource NeutralTextBrush}" />
                                                                    <TextBlock Text="{Binding Load, StringFormat={}{0:0}}"
                                                                               Foreground="{StaticResource PrimaryTextBrush}"
                                                                               FontWeight="SemiBold"
                                                                               Margin="8,0,0,0" />
                                                                </StackPanel>

                                                                <Slider Minimum="0"
                                                                        Maximum="120"
                                                                        SmallChange="5"
                                                                        LargeChange="5"
                                                                        Value="{Binding Load, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                                        Margin="0,6,0,10" />

                                                                <TextBlock Text="Detail"
                                                                           Foreground="{StaticResource NeutralTextBrush}" />
                                                                <TextBox Text="{Binding Detail, UpdateSourceTrigger=PropertyChanged}"
                                                                         Margin="0,6,0,0"
                                                                         Background="#152032"
                                                                         Foreground="{StaticResource PrimaryTextBrush}"
                                                                         BorderBrush="{StaticResource OverlayListItemBorderBrush}"
                                                                         BorderThickness="1"
                                                                         Padding="8,6"
                                                                         AcceptsReturn="True"
                                                                         TextWrapping="Wrap"
                                                                         MinHeight="48" />
                                                            </StackPanel>
                                                        </Border>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                        </StackPanel>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </ScrollViewer>

                <Grid Grid.Row="1">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <TextBlock Grid.Column="0"
                               Text="{Binding ValidationMessage}"
                               Foreground="{StaticResource AlertTextBrush}"
                               VerticalAlignment="Center"
                               Margin="0,0,16,0"
                               Visibility="{Binding HasValidationMessage, Converter={StaticResource BooleanToVisibilityConverter}}" />

                    <Button Grid.Column="1"
                            Margin="0,0,12,0"
                            Style="{StaticResource PaletteSecondaryButtonStyle}"
                            Command="{Binding CancelCommand}"
                            Content="Cancel" />

                    <Button Grid.Column="2"
                            Style="{StaticResource PalettePrimaryButtonStyle}"
                            Command="{Binding SaveCommand}"
                            Content="Save Changes" />
                </Grid>
            </Grid>
        </DataTemplate>

        <DataTemplate x:Key="TransferNegotiationCardBodyTemplate">
            <Grid>
                <ItemsControl ItemsSource="{Binding Negotiations.Deals}">
                    <ItemsControl.Style>
                        <Style TargetType="ItemsControl">
                            <Setter Property="Visibility" Value="Collapsed" />
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding HasNegotiations}" Value="True">
                                    <Setter Property="Visibility" Value="Visible" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </ItemsControl.Style>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate DataType="{x:Type vm:TransferNegotiationDealCardViewModel}">
                            <Border Padding="18"
                                    Margin="0,0,0,16"
                                    Background="{StaticResource SurfaceMediumBrush}"
                                    BorderBrush="{StaticResource SurfaceToolbarBorderBrush}"
                                    BorderThickness="1"
                                    CornerRadius="18">
                                <StackPanel>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>

                                        <StackPanel>
                                            <TextBlock Text="{Binding Player}"
                                                       Foreground="{StaticResource PrimaryTextBrush}"
                                                       FontSize="18"
                                                       FontWeight="SemiBold" />
                                            <StackPanel Orientation="Horizontal"
                                                        Margin="0,8,0,0">
                                                <TextBlock Text="{Binding Position}"
                                                           Foreground="{StaticResource NeutralTextBrush}" />
                                                <TextBlock Text="  "
                                                           Foreground="{StaticResource NeutralTextBrush}"
                                                           Margin="8,0" />
                                                <TextBlock Text="{Binding Club}"
                                                           Foreground="{StaticResource NeutralTextBrush}" />
                                            </StackPanel>
                                        </StackPanel>

                                        <StackPanel Grid.Column="1"
                                                    HorizontalAlignment="Right">
                                            <TextBlock Text="{Binding Stage}"
                                                       Foreground="{StaticResource NeutralTextBrush}"
                                                       HorizontalAlignment="Right" />
                                            <Border Background="#2EC4B622"
                                                    Padding="12,4"
                                                    CornerRadius="14"
                                                    Margin="0,8,0,0"
                                                    HorizontalAlignment="Right"
                                                    Visibility="{Binding HasAccent, Converter={StaticResource BooleanToVisibilityConverter}}">
                                                <TextBlock Text="{Binding Accent}"
                                                           Foreground="{StaticResource AccentPrimaryBrush}"
                                                           FontWeight="SemiBold" />
                                            </Border>
                                            <TextBlock Text="{Binding Deadline}"
                                                       Foreground="{StaticResource NeutralTextBrush}"
                                                       HorizontalAlignment="Right"
                                                       Margin="0,8,0,0" />
                                            <Border Background="{StaticResource AccentPrimaryBrush}"
                                                    Padding="14,4"
                                                    CornerRadius="14"
                                                    Margin="0,8,0,0"
                                                    HorizontalAlignment="Right">
                                                <TextBlock Text="{Binding Status}"
                                                           Foreground="White"
                                                           FontWeight="SemiBold" />
                                            </Border>
                                        </StackPanel>
                                    </Grid>

                                    <ItemsControl Margin="0,18,0,0"
                                                  ItemsSource="{Binding Terms}">
                                        <ItemsControl.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <WrapPanel />
                                            </ItemsPanelTemplate>
                                        </ItemsControl.ItemsPanel>
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate DataType="{x:Type vm:TransferNegotiationTermCardViewModel}">
                                                <Border Width="220"
                                                        Margin="0,0,16,16"
                                                        Background="#152032"
                                                        BorderBrush="#233246"
                                                        BorderThickness="1"
                                                        CornerRadius="16"
                                                        Padding="14">
                                                    <StackPanel>
                                                        <TextBlock Text="{Binding Label}"
                                                                   Foreground="{StaticResource PrimaryTextBrush}"
                                                                   FontWeight="SemiBold" />
                                                        <ProgressBar Value="{Binding Progress}"
                                                                     Maximum="1"
                                                                     Height="6"
                                                                     Margin="0,10,0,0"
                                                                     Foreground="{StaticResource AccentSecondaryBrush}"
                                                                     Background="#101623" />
                                                        <StackPanel Orientation="Horizontal"
                                                                    Margin="0,10,0,0">
                                                            <TextBlock Text="{Binding DisplayValue}"
                                                                       Foreground="{StaticResource PrimaryTextBrush}"
                                                                       FontWeight="SemiBold" />
                                                            <TextBlock Text="/"
                                                                       Margin="8,0"
                                                                       Foreground="{StaticResource NeutralTextBrush}" />
                                                            <TextBlock Text="{Binding TargetDisplay}"
                                                                       Foreground="{StaticResource NeutralTextBrush}" />
                                                        </StackPanel>
                                                        <TextBlock Text="{Binding DeltaDisplay}"
                                                                   Margin="0,8,0,0">
                                                            <TextBlock.Style>
                                                                <Style TargetType="TextBlock">
                                                                    <Setter Property="Foreground" Value="{StaticResource AccentSecondaryBrush}" />
                                                                    <Style.Triggers>
                                                                        <DataTrigger Binding="{Binding IsTargetMet}" Value="False">
                                                                            <Setter Property="Foreground" Value="{StaticResource AlertTextBrush}" />
                                                                        </DataTrigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </TextBlock.Style>
                                                        </TextBlock>
                                                        <TextBlock Text="{Binding Tooltip}"
                                                                   Foreground="{StaticResource NeutralTextBrush}"
                                                                   FontSize="11"
                                                                   Margin="0,8,0,0"
                                                                   TextWrapping="Wrap"
                                                                   Visibility="{Binding Tooltip, Converter={StaticResource NullToVisibilityConverter}}" />
                                                    </StackPanel>
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>

                                    <TextBlock Text="{Binding Summary}"
                                               Foreground="{StaticResource PrimaryTextBrush}"
                                               Margin="0,6,0,0"
                                               TextWrapping="Wrap"
                                               Visibility="{Binding HasSummary, Converter={StaticResource BooleanToVisibilityConverter}}" />

                                    <TextBlock Text="{Binding Agent}"
                                               Foreground="{StaticResource NeutralTextBrush}"
                                               Margin="0,4,0,0"
                                               TextWrapping="Wrap"
                                               Visibility="{Binding HasAgent, Converter={StaticResource BooleanToVisibilityConverter}}" />

                                    <Border Background="#1B2435"
                                            CornerRadius="14"
                                            Padding="14"
                                            Margin="0,8,0,0"
                                            Visibility="{Binding HasResponse, Converter={StaticResource BooleanToVisibilityConverter}}">
                                        <TextBlock Text="{Binding Response}"
                                                   Foreground="{StaticResource PrimaryTextBrush}"
                                                   TextWrapping="Wrap" />
                                    </Border>
                                </StackPanel>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>

                <TextBlock Text="No active negotiations configured"
                           Foreground="{StaticResource NeutralTextBrush}"
                           FontStyle="Italic"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"
                           Margin="0,24,0,0">
                    <TextBlock.Style>
                        <Style TargetType="TextBlock">
                            <Setter Property="Visibility" Value="Visible" />
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding HasNegotiations}" Value="True">
                                    <Setter Property="Visibility" Value="Collapsed" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </TextBlock.Style>
                </TextBlock>
            </Grid>
        </DataTemplate>

        <views:CardBodyTemplateSelector x:Key="CardBodyTemplateSelector"
                                        MetricTemplate="{StaticResource MetricCardBodyTemplate}"
                                        ListTemplate="{StaticResource ListCardBodyTemplate}"
                                        FormationTemplate="{StaticResource FormationCardBodyTemplate}"
                                        FixtureTemplate="{StaticResource FixtureCardBodyTemplate}"
                                        StatusTemplate="{StaticResource StatusCardBodyTemplate}"
                                        LineChartTemplate="{StaticResource LineChartCardBodyTemplate}"
                                        GaugeTemplate="{StaticResource GaugeCardBodyTemplate}"
                                        TimelineTemplate="{StaticResource TimelineCardBodyTemplate}"
                                        TrainingCalendarTemplate="{StaticResource TrainingCalendarCardBodyTemplate}"
                                        FixtureCalendarTemplate="{StaticResource FixtureCalendarCardBodyTemplate}"
                                        ForecastTemplate="{StaticResource ForecastCardBodyTemplate}"
                                        WorkloadHeatmapTemplate="{StaticResource WorkloadHeatmapCardBodyTemplate}"
                                        SquadTableTemplate="{StaticResource SquadTableCardBodyTemplate}"
                                        TransferNegotiationTemplate="{StaticResource TransferNegotiationCardBodyTemplate}"
                                        ScoutAssignmentsTemplate="{StaticResource ScoutAssignmentsCardBodyTemplate}"
                                        ShortlistBoardTemplate="{StaticResource ShortlistBoardCardBodyTemplate}" />

        <DataTemplate DataType="{x:Type vm:CardViewModel}">
            <Grid Width="{Binding Width}" Height="{Binding Height}">
                <Border Style="{StaticResource CardBorderStyle}"
                        HorizontalAlignment="Stretch"
                        VerticalAlignment="Stretch">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="{Binding Title}" Style="{StaticResource CardTitleTextStyle}" />
                                <Border Margin="12,0,0,0"
                                        Padding="10,4"
                                        Background="#2EC4B622"
                                        CornerRadius="12"
                                        Visibility="{Binding HasPill, Converter={StaticResource BooleanToVisibilityConverter}}">
                                    <TextBlock Text="{Binding PillText}"
                                               Foreground="{StaticResource AccentPrimaryBrush}"
                                               FontSize="12"
                                               FontWeight="SemiBold" />
                                </Border>
                            </StackPanel>

                            <StackPanel Grid.Column="1"
                                        Orientation="Horizontal"
                                        HorizontalAlignment="Right">
                                <Button Style="{StaticResource CardHeaderButtonStyle}"
                                        Command="{Binding OpenEditorCommand}"
                                        Visibility="{Binding IsEditorAvailable, Converter={StaticResource BooleanToVisibilityConverter}}"
                                        AutomationProperties.Name="Edit card content">
                                    <AccessText Text="_Edit" />
                                </Button>
                            </StackPanel>
                        </Grid>

                        <TextBlock Grid.Row="1"
                                   Margin="0,8,0,0"
                                   Text="{Binding Subtitle}"
                                   Style="{StaticResource CardSubtitleTextStyle}"
                                   Visibility="{Binding HasSubtitle, Converter={StaticResource BooleanToVisibilityConverter}}" />

                        <StackPanel Grid.Row="2" Margin="0,16,0,0">
                            <TextBlock Text="{Binding Description}"
                                       Foreground="{StaticResource NeutralTextBrush}"
                                       FontSize="13"
                                       TextWrapping="Wrap"
                                       Visibility="{Binding HasDescription, Converter={StaticResource BooleanToVisibilityConverter}}" />
                            <ContentControl Content="{Binding}"
                                            ContentTemplateSelector="{StaticResource CardBodyTemplateSelector}">
                                <ContentControl.Style>
                                    <Style TargetType="ContentControl">
                                        <Setter Property="Margin" Value="0,12,0,0" />
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding HasDescription}" Value="False">
                                                <Setter Property="Margin" Value="0" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </ContentControl.Style>
                            </ContentControl>
                        </StackPanel>
                    </Grid>
                </Border>

                <controls:CardDragThumb DragStartedCommand="{Binding BeginDragCommand}"
                                        DragDeltaCommand="{Binding DragDeltaCommand}"
                                        DragCompletedCommand="{Binding CompleteDragCommand}"
                                        HorizontalAlignment="Stretch"
                                        VerticalAlignment="Stretch"
                                        Cursor="SizeAll"
                                        Focusable="True" />

                <controls:CardResizeThumb Handle="East"
                                          DragStartedCommand="{Binding BeginResizeCommand}"
                                          DragDeltaCommand="{Binding ResizeDeltaCommand}"
                                          DragCompletedCommand="{Binding CompleteResizeCommand}"
                                          HorizontalAlignment="Right"
                                          VerticalAlignment="Stretch"
                                          Width="8"
                                          Cursor="SizeWE"
                                          Focusable="False" />

                <controls:CardResizeThumb Handle="South"
                                          DragStartedCommand="{Binding BeginResizeCommand}"
                                          DragDeltaCommand="{Binding ResizeDeltaCommand}"
                                          DragCompletedCommand="{Binding CompleteResizeCommand}"
                                          HorizontalAlignment="Stretch"
                                          VerticalAlignment="Bottom"
                                          Height="8"
                                          Cursor="SizeNS"
                                          Focusable="False" />

                <controls:CardResizeThumb Handle="SouthEast"
                                          DragStartedCommand="{Binding BeginResizeCommand}"
                                          DragDeltaCommand="{Binding ResizeDeltaCommand}"
                                          DragCompletedCommand="{Binding CompleteResizeCommand}"
                                          HorizontalAlignment="Right"
                                          VerticalAlignment="Bottom"
                                          Width="14"
                                          Height="14"
                                          Cursor="SizeNWSE"
                                          Background="#33FFFFFF"
                                          Focusable="False" />
            </Grid>
        </DataTemplate>
    </UserControl.Resources>

    <Border Background="#111622"
            CornerRadius="18"
            SnapsToDevicePixels="True">
        <Grid>
            <Grid.Background>
                <DrawingBrush TileMode="Tile"
                              Viewport="0,0,32,32"
                              ViewportUnits="Absolute"
                              Stretch="None">
                    <DrawingBrush.Drawing>
                        <GeometryDrawing Brush="Transparent">
                            <GeometryDrawing.Pen>
                                <Pen Brush="#112EC4B6" Thickness="1" />
                            </GeometryDrawing.Pen>
                            <GeometryDrawing.Geometry>
                                <RectangleGeometry Rect="0,0,32,32" />
                            </GeometryDrawing.Geometry>
                        </GeometryDrawing>
                    </DrawingBrush.Drawing>
                </DrawingBrush>
            </Grid.Background>

            <ScrollViewer x:Name="SurfaceScrollViewer"
                          HorizontalScrollBarVisibility="Auto"
                          VerticalScrollBarVisibility="Auto"
                          CanContentScroll="True"
                          Loaded="OnSurfaceLoaded"
                          ScrollChanged="OnSurfaceScrollChanged"
                          SizeChanged="OnSurfaceSizeChanged">
                <Grid Width="{Binding SurfaceWidth}"
                      Height="{Binding SurfaceHeight}">
                    <ItemsControl ItemsSource="{Binding Cards}"
                                  VirtualizingPanel.IsVirtualizing="True"
                                  VirtualizingPanel.VirtualizationMode="Recycling"
                                  HorizontalAlignment="Left"
                                  VerticalAlignment="Top">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <controls:VirtualizingCardPanel SurfaceWidth="{Binding SurfaceWidth}"
                                                               SurfaceHeight="{Binding SurfaceHeight}" />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemContainerStyle>
                            <Style TargetType="ContentPresenter">
                                <Setter Property="Visibility" Value="{Binding IsVisible, Converter={StaticResource BooleanToVisibilityConverter}}" />
                            </Style>
                        </ItemsControl.ItemContainerStyle>
                    </ItemsControl>

                    <ItemsControl ItemsSource="{Binding Previews}"
                                  ItemTemplate="{StaticResource CardPreviewTemplate}"
                                  HorizontalAlignment="Left"
                                  VerticalAlignment="Top"
                                  IsHitTestVisible="False">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <Canvas />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemContainerStyle>
                            <Style TargetType="ContentPresenter">
                                <Setter Property="Panel.ZIndex" Value="10" />
                            </Style>
                        </ItemsControl.ItemContainerStyle>
                    </ItemsControl>
                </Grid>
            </ScrollViewer>

            <Border HorizontalAlignment="Right"
                    VerticalAlignment="Top"
                    Margin="24"
                    Padding="12"
                    Background="{StaticResource SurfaceToolbarBackgroundBrush}"
                    BorderBrush="{StaticResource SurfaceToolbarBorderBrush}"
                    BorderThickness="1"
                    CornerRadius="18"
                    Panel.ZIndex="15">
                <StackPanel Orientation="Horizontal"
                            HorizontalAlignment="Right">
                    <Button Style="{StaticResource SurfaceToolbarButtonStyle}"
                            Command="{Binding OpenPaletteCommand}"
                            AutomationProperties.Name="Open card catalog">
                        <AccessText Text="_Add Card" />
                    </Button>
                    <Button Style="{StaticResource SurfaceToolbarButtonStyle}"
                            Command="{Binding RemoveSelectedCardsCommand}"
                            Margin="12,0,0,0"
                            AutomationProperties.Name="Remove selected cards">
                        <AccessText Text="_Remove Selected" />
                    </Button>
                </StackPanel>
            </Border>

            <Rectangle Visibility="{Binding IsPaletteOpen, Converter={StaticResource BooleanToVisibilityConverter}}"
                       Fill="{StaticResource OverlayBackdropBrush}"
                       Panel.ZIndex="19"
                       HorizontalAlignment="Stretch"
                       VerticalAlignment="Stretch"
                       MouseLeftButtonDown="OnPaletteBackdropClicked" />

            <Border Visibility="{Binding IsPaletteOpen, Converter={StaticResource BooleanToVisibilityConverter}}"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    CornerRadius="20"
                    Background="{StaticResource OverlaySurfaceBrush}"
                    BorderThickness="1"
                    BorderBrush="{StaticResource OverlayBorderBrush}"
                    Padding="24"
                    Panel.ZIndex="20"
                    Width="520"
                    MaxHeight="560"
                    FocusManager.IsFocusScope="True"
                    FocusManager.FocusedElement="{Binding ElementName=PaletteListBox}"
                    KeyboardNavigation.TabNavigation="Cycle"
                    KeyboardNavigation.ControlTabNavigation="Cycle"
                    KeyboardNavigation.DirectionalNavigation="Cycle"
                    AutomationProperties.Name="Card catalog overlay">
                <Border.InputBindings>
                    <KeyBinding Key="Escape" Command="{Binding ClosePaletteCommand}" />
                    <KeyBinding Key="Enter" Command="{Binding CreateCardCommand}" />
                </Border.InputBindings>
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <Grid Grid.Row="0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <TextBlock x:Name="PaletteHeading"
                                   Text="Card Catalog"
                                   FontSize="20"
                                   FontWeight="Bold"
                                   Foreground="{StaticResource PrimaryTextBrush}"
                                   AutomationProperties.HeadingLevel="Level2" />
                        <Button Grid.Column="1"
                                Style="{StaticResource PaletteSecondaryButtonStyle}"
                                Command="{Binding ClosePaletteCommand}"
                                Margin="12,0,0,0"
                                AutomationProperties.Name="Close card catalog">
                            <AccessText Text="_Close" />
                        </Button>
                    </Grid>

                    <ListBox x:Name="PaletteListBox"
                             Grid.Row="1"
                             ItemsSource="{Binding Palette}"
                             SelectedItem="{Binding SelectedPreset}"
                             Margin="0,18"
                             BorderThickness="1"
                             BorderBrush="{StaticResource OverlayListItemBorderBrush}"
                             Background="{StaticResource OverlayListBackgroundBrush}"
                             Foreground="{StaticResource PrimaryTextBrush}"
                             SelectionMode="Single"
                             HorizontalContentAlignment="Stretch"
                             ScrollViewer.VerticalScrollBarVisibility="Auto"
                             KeyboardNavigation.TabNavigation="Cycle"
                             KeyboardNavigation.DirectionalNavigation="Cycle"
                             AutomationProperties.Name="Card catalog presets"
                             ItemContainerStyle="{StaticResource PaletteListBoxItemStyle}">
                        <ListBox.ItemTemplate>
                            <DataTemplate DataType="{x:Type vm:CardPresetViewModel}">
                                <Border>
                                    <StackPanel>
                                        <TextBlock Text="{Binding DisplayName}"
                                                   FontWeight="SemiBold"
                                                   FontSize="16"
                                                   Foreground="{StaticResource PrimaryTextBrush}"
                                                   TextWrapping="Wrap" />
                                        <TextBlock Text="{Binding Description}"
                                                   Foreground="{StaticResource NeutralTextBrush}"
                                                   TextWrapping="Wrap"
                                                   Margin="0,4,0,0" />
                                    </StackPanel>
                                </Border>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>

                    <StackPanel Grid.Row="2"
                                Orientation="Horizontal"
                                HorizontalAlignment="Right">
                        <Button Style="{StaticResource PalettePrimaryButtonStyle}"
                                Command="{Binding CreateCardCommand}"
                                Margin="0,0,12,0"
                                IsDefault="True"
                                AutomationProperties.Name="Add selected card to surface">
                            <AccessText Text="_Add Card" />
                        </Button>
                        <Button Style="{StaticResource PaletteSecondaryButtonStyle}"
                                Command="{Binding ClosePaletteCommand}"
                                AutomationProperties.Name="Cancel card addition">
                            <AccessText Text="_Cancel" />
                        </Button>
                    </StackPanel>
                </Grid>
            </Border>

            <Rectangle Visibility="{Binding IsEditorOpen, Converter={StaticResource BooleanToVisibilityConverter}}"
                       Fill="{StaticResource OverlayBackdropBrush}"
                       Panel.ZIndex="23"
                       HorizontalAlignment="Stretch"
                       VerticalAlignment="Stretch"
                       MouseLeftButtonDown="OnEditorBackdropClicked" />

            <Border x:Name="EditorOverlayRoot"
                    Visibility="{Binding IsEditorOpen, Converter={StaticResource BooleanToVisibilityConverter}}"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    CornerRadius="20"
                    Background="{StaticResource OverlaySurfaceBrush}"
                    BorderThickness="1"
                    BorderBrush="{StaticResource OverlayBorderBrush}"
                    Padding="24"
                    Panel.ZIndex="24"
                    Width="560"
                    MaxHeight="620"
                    FocusManager.IsFocusScope="True"
                    KeyboardNavigation.TabNavigation="Cycle"
                    KeyboardNavigation.ControlTabNavigation="Cycle"
                    KeyboardNavigation.DirectionalNavigation="Cycle"
                    AutomationProperties.Name="Card editor overlay">
                <Border.InputBindings>
                    <KeyBinding Key="Escape" Command="{Binding CloseEditorCommand}" />
                </Border.InputBindings>
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <Grid Grid.Row="0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="{Binding ActiveEditor.Title}"
                                   FontSize="20"
                                   FontWeight="Bold"
                                   Foreground="{StaticResource PrimaryTextBrush}"
                                   AutomationProperties.HeadingLevel="Level2" />
                        <Button Grid.Column="1"
                                Style="{StaticResource PaletteSecondaryButtonStyle}"
                                Command="{Binding CloseEditorCommand}"
                                Margin="12,0,0,0"
                                AutomationProperties.Name="Close editor overlay">
                            <AccessText Text="_Close" />
                        </Button>
                    </Grid>

                    <TextBlock Grid.Row="1"
                               Text="{Binding ActiveEditor.Subtitle}"
                               Foreground="{StaticResource NeutralTextBrush}"
                               Margin="0,12,0,0">
                        <TextBlock.Style>
                            <Style TargetType="TextBlock">
                                <Setter Property="Visibility" Value="Collapsed" />
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding ActiveEditor.HasSubtitle}" Value="True">
                                        <Setter Property="Visibility" Value="Visible" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </TextBlock.Style>
                    </TextBlock>

                    <ContentPresenter x:Name="EditorContentPresenter"
                                      Grid.Row="2"
                                      Margin="0,20,0,24"
                                      Content="{Binding ActiveEditor}" />

                    <StackPanel Grid.Row="3"
                                Orientation="Horizontal"
                                HorizontalAlignment="Right">
                        <Button Style="{StaticResource PalettePrimaryButtonStyle}"
                                Command="{Binding ActiveEditor.SaveCommand}"
                                Margin="0,0,12,0"
                                AutomationProperties.Name="Save editor changes">
                            <AccessText Text="_Save Changes" />
                        </Button>
                        <Button Style="{StaticResource PaletteSecondaryButtonStyle}"
                                Command="{Binding ActiveEditor.CancelCommand}"
                                AutomationProperties.Name="Cancel editor changes">
                            <AccessText Text="_Cancel" />
                        </Button>
                    </StackPanel>
                </Grid>
            </Border>

            <StackPanel HorizontalAlignment="Center"
                        VerticalAlignment="Center">
                <StackPanel.Style>
                    <Style TargetType="StackPanel">
                        <Setter Property="Visibility" Value="Collapsed" />
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding HasCards}" Value="False">
                                <Setter Property="Visibility" Value="Visible" />
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </StackPanel.Style>
                <TextBlock Text="{Binding EmptyMessage}"
                           Foreground="{StaticResource NeutralTextBrush}"
                           FontSize="16"
                           TextAlignment="Center"
                           TextWrapping="Wrap"
                           MaxWidth="520" />
            </StackPanel>
        </Grid>
    </Border>
</UserControl>
